{"ast":null,"code":"/*!!\n *  Canvas 2 Svg v1.0.21\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\n *\n *  Licensed under the MIT license:\n *  http://www.opensource.org/licenses/mit-license.php\n *\n *  Author:\n *  Kerry Liu\n *\n *  Copyright (c) 2014 Gliffy Inc.\n */\nvar STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities; //helper function to format a string\n\nfunction format(str, args) {\n  var keys = Object.keys(args),\n      i;\n\n  for (i = 0; i < keys.length; i++) {\n    str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\n  }\n\n  return str;\n} //helper function that generates a random string\n\n\nfunction randomString(holder) {\n  var chars, randomstring, i;\n\n  if (!holder) {\n    throw new Error(\"cannot create a random attribute name for an undefined object\");\n  }\n\n  chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\n  randomstring = \"\";\n\n  do {\n    randomstring = \"\";\n\n    for (i = 0; i < 12; i++) {\n      randomstring += chars[Math.floor(Math.random() * chars.length)];\n    }\n  } while (holder[randomstring]);\n\n  return randomstring;\n} //helper function to map named to numbered entities\n\n\nfunction createNamedToNumberedLookup(items, radix) {\n  var i,\n      entity,\n      lookup = {},\n      base10,\n      base16;\n  items = items.split(',');\n  radix = radix || 10; // Map from named to numbered entities.\n\n  for (i = 0; i < items.length; i += 2) {\n    entity = '&' + items[i + 1] + ';';\n    base10 = parseInt(items[i], radix);\n    lookup[entity] = '&#' + base10 + ';';\n  } //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\n\n\n  lookup[\"\\\\xa0\"] = '&#160;';\n  return lookup;\n} //helper function to map canvas-textAlign to svg-textAnchor\n\n\nfunction getTextAnchor(textAlign) {\n  //TODO: support rtl languages\n  var mapping = {\n    \"left\": \"start\",\n    \"right\": \"end\",\n    \"center\": \"middle\",\n    \"start\": \"start\",\n    \"end\": \"end\"\n  };\n  return mapping[textAlign] || mapping.start;\n} //helper function to map canvas-textBaseline to svg-dominantBaseline\n\n\nfunction getDominantBaseline(textBaseline) {\n  //INFO: not supported in all browsers\n  var mapping = {\n    \"alphabetic\": \"alphabetic\",\n    \"hanging\": \"hanging\",\n    \"top\": \"text-before-edge\",\n    \"bottom\": \"text-after-edge\",\n    \"middle\": \"central\"\n  };\n  return mapping[textBaseline] || mapping.alphabetic;\n} // Unpack entities lookup where the numbers are in radix 32 to reduce the size\n// entity mapping courtesy of tinymce\n\n\nnamedEntities = createNamedToNumberedLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32); //Some basic mappings for attributes and default values.\n\nSTYLES = {\n  \"strokeStyle\": {\n    svgAttr: \"stroke\",\n    //corresponding svg attribute\n    canvas: \"#000000\",\n    //canvas default\n    svg: \"none\",\n    //svg default\n    apply: \"stroke\" //apply on stroke() or fill()\n\n  },\n  \"fillStyle\": {\n    svgAttr: \"fill\",\n    canvas: \"#000000\",\n    svg: null,\n    //svg default is black, but we need to special case this to handle canvas stroke without fill\n    apply: \"fill\"\n  },\n  \"lineCap\": {\n    svgAttr: \"stroke-linecap\",\n    canvas: \"butt\",\n    svg: \"butt\",\n    apply: \"stroke\"\n  },\n  \"lineJoin\": {\n    svgAttr: \"stroke-linejoin\",\n    canvas: \"miter\",\n    svg: \"miter\",\n    apply: \"stroke\"\n  },\n  \"miterLimit\": {\n    svgAttr: \"stroke-miterlimit\",\n    canvas: 10,\n    svg: 4,\n    apply: \"stroke\"\n  },\n  \"lineWidth\": {\n    svgAttr: \"stroke-width\",\n    canvas: 1,\n    svg: 1,\n    apply: \"stroke\"\n  },\n  \"globalAlpha\": {\n    svgAttr: \"opacity\",\n    canvas: 1,\n    svg: 1,\n    apply: \"fill stroke\"\n  },\n  \"font\": {\n    //font converts to multiple svg attributes, there is custom logic for this\n    canvas: \"10px sans-serif\"\n  },\n  \"shadowColor\": {\n    canvas: \"#000000\"\n  },\n  \"shadowOffsetX\": {\n    canvas: 0\n  },\n  \"shadowOffsetY\": {\n    canvas: 0\n  },\n  \"shadowBlur\": {\n    canvas: 0\n  },\n  \"textAlign\": {\n    canvas: \"start\"\n  },\n  \"textBaseline\": {\n    canvas: \"alphabetic\"\n  },\n  \"lineDash\": {\n    svgAttr: \"stroke-dasharray\",\n    canvas: [],\n    svg: null,\n    apply: \"stroke\"\n  }\n};\n/**\n *\n * @param gradientNode - reference to the gradient\n * @constructor\n */\n\nCanvasGradient = function (gradientNode, ctx) {\n  this.__root = gradientNode;\n  this.__ctx = ctx;\n};\n/**\n * Adds a color stop to the gradient root\n */\n\n\nCanvasGradient.prototype.addColorStop = function (offset, color) {\n  var stop = this.__ctx.__createElement(\"stop\"),\n      regex,\n      matches;\n\n  stop.setAttribute(\"offset\", offset);\n\n  if (color.indexOf(\"rgba\") !== -1) {\n    //separate alpha value, since webkit can't handle it\n    regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n    matches = regex.exec(color);\n    stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {\n      r: matches[1],\n      g: matches[2],\n      b: matches[3]\n    }));\n    stop.setAttribute(\"stop-opacity\", matches[4]);\n  } else {\n    stop.setAttribute(\"stop-color\", color);\n  }\n\n  this.__root.appendChild(stop);\n};\n\nCanvasPattern = function (pattern, ctx) {\n  this.__root = pattern;\n  this.__ctx = ctx;\n};\n/**\n * The mock canvas context\n * @param o - options include:\n * ctx - existing Context2D to wrap around\n * width - width of your canvas (defaults to 500)\n * height - height of your canvas (defaults to 500)\n * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\n * document - the document object (defaults to the current document)\n */\n\n\nctx = function (o) {\n  var defaultOptions = {\n    width: 500,\n    height: 500,\n    enableMirroring: false\n  },\n      options; //keep support for this way of calling C2S: new C2S(width,height)\n\n  if (arguments.length > 1) {\n    options = defaultOptions;\n    options.width = arguments[0];\n    options.height = arguments[1];\n  } else if (!o) {\n    options = defaultOptions;\n  } else {\n    options = o;\n  }\n\n  if (!(this instanceof ctx)) {\n    //did someone call this without new?\n    return new ctx(options);\n  } //setup options\n\n\n  this.width = options.width || defaultOptions.width;\n  this.height = options.height || defaultOptions.height;\n  this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\n  this.canvas = this; ///point back to this instance!\n\n  this.__document = options.document || document; // allow passing in an existing context to wrap around\n  // if a context is passed in, we know a canvas already exist\n\n  if (options.ctx) {\n    this.__ctx = options.ctx;\n  } else {\n    this.__canvas = this.__document.createElement(\"canvas\");\n    this.__ctx = this.__canvas.getContext(\"2d\");\n  }\n\n  this.__setDefaultStyles();\n\n  this.__stack = [this.__getStyleState()];\n  this.__groupStack = []; //the root svg element\n\n  this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\n  this.__root.setAttribute(\"version\", 1.1);\n\n  this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n\n  this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n\n  this.__root.setAttribute(\"width\", this.width);\n\n  this.__root.setAttribute(\"height\", this.height); //make sure we don't generate the same ids in defs\n\n\n  this.__ids = {}; //defs tag\n\n  this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n\n  this.__root.appendChild(this.__defs); //also add a group child. the svg element can't use the transform attribute\n\n\n  this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n\n  this.__root.appendChild(this.__currentElement);\n};\n/**\n * Creates the specified svg element\n * @private\n */\n\n\nctx.prototype.__createElement = function (elementName, properties, resetFill) {\n  if (typeof properties === \"undefined\") {\n    properties = {};\n  }\n\n  var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\n      keys = Object.keys(properties),\n      i,\n      key;\n\n  if (resetFill) {\n    //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\n    element.setAttribute(\"fill\", \"none\");\n    element.setAttribute(\"stroke\", \"none\");\n  }\n\n  for (i = 0; i < keys.length; i++) {\n    key = keys[i];\n    element.setAttribute(key, properties[key]);\n  }\n\n  return element;\n};\n/**\n * Applies default canvas styles to the context\n * @private\n */\n\n\nctx.prototype.__setDefaultStyles = function () {\n  //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\n  var keys = Object.keys(STYLES),\n      i,\n      key;\n\n  for (i = 0; i < keys.length; i++) {\n    key = keys[i];\n    this[key] = STYLES[key].canvas;\n  }\n};\n/**\n * Applies styles on restore\n * @param styleState\n * @private\n */\n\n\nctx.prototype.__applyStyleState = function (styleState) {\n  var keys = Object.keys(styleState),\n      i,\n      key;\n\n  for (i = 0; i < keys.length; i++) {\n    key = keys[i];\n    this[key] = styleState[key];\n  }\n};\n/**\n * Gets the current style state\n * @return {Object}\n * @private\n */\n\n\nctx.prototype.__getStyleState = function () {\n  var i,\n      styleState = {},\n      keys = Object.keys(STYLES),\n      key;\n\n  for (i = 0; i < keys.length; i++) {\n    key = keys[i];\n    styleState[key] = this[key];\n  }\n\n  return styleState;\n};\n/**\n * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\n * @param type\n * @private\n */\n\n\nctx.prototype.__applyStyleToCurrentElement = function (type) {\n  var currentElement = this.__currentElement;\n  var currentStyleGroup = this.__currentElementsToStyle;\n\n  if (currentStyleGroup) {\n    currentElement.setAttribute(type, \"\");\n    currentElement = currentStyleGroup.element;\n    currentStyleGroup.children.forEach(function (node) {\n      node.setAttribute(type, \"\");\n    });\n  }\n\n  var keys = Object.keys(STYLES),\n      i,\n      style,\n      value,\n      id,\n      regex,\n      matches;\n\n  for (i = 0; i < keys.length; i++) {\n    style = STYLES[keys[i]];\n    value = this[keys[i]];\n\n    if (style.apply) {\n      //is this a gradient or pattern?\n      if (value instanceof CanvasPattern) {\n        //pattern\n        if (value.__ctx) {\n          //copy over defs\n          while (value.__ctx.__defs.childNodes.length) {\n            id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\n            this.__ids[id] = id;\n\n            this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\n          }\n        }\n\n        currentElement.setAttribute(style.apply, format(\"url(#{id})\", {\n          id: value.__root.getAttribute(\"id\")\n        }));\n      } else if (value instanceof CanvasGradient) {\n        //gradient\n        currentElement.setAttribute(style.apply, format(\"url(#{id})\", {\n          id: value.__root.getAttribute(\"id\")\n        }));\n      } else if (style.apply.indexOf(type) !== -1 && style.svg !== value) {\n        if ((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\n          //separate alpha value, since illustrator can't handle it\n          regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n          matches = regex.exec(value);\n          currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {\n            r: matches[1],\n            g: matches[2],\n            b: matches[3]\n          })); //should take globalAlpha here\n\n          var opacity = matches[4];\n          var globalAlpha = this.globalAlpha;\n\n          if (globalAlpha != null) {\n            opacity *= globalAlpha;\n          }\n\n          currentElement.setAttribute(style.svgAttr + \"-opacity\", opacity);\n        } else {\n          var attr = style.svgAttr;\n\n          if (keys[i] === 'globalAlpha') {\n            attr = type + '-' + style.svgAttr;\n\n            if (currentElement.getAttribute(attr)) {\n              //fill-opacity or stroke-opacity has already been set by stroke or fill.\n              continue;\n            }\n          } //otherwise only update attribute if right type, and not svg default\n\n\n          currentElement.setAttribute(attr, value);\n        }\n      }\n    }\n  }\n};\n/**\n * Will return the closest group or svg node. May return the current element.\n * @private\n */\n\n\nctx.prototype.__closestGroupOrSvg = function (node) {\n  node = node || this.__currentElement;\n\n  if (node.nodeName === \"g\" || node.nodeName === \"svg\") {\n    return node;\n  } else {\n    return this.__closestGroupOrSvg(node.parentNode);\n  }\n};\n/**\n * Returns the serialized value of the svg so far\n * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\n *                           If true, we attempt to find all named entities and encode it as a numeric entity.\n * @return serialized svg\n */\n\n\nctx.prototype.getSerializedSvg = function (fixNamedEntities) {\n  var serialized = new XMLSerializer().serializeToString(this.__root),\n      keys,\n      i,\n      key,\n      value,\n      regexp,\n      xmlns; //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\n\n  xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\n\n  if (xmlns.test(serialized)) {\n    serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg', 'xmlns:xlink=\"http://www.w3.org/1999/xlink');\n  }\n\n  if (fixNamedEntities) {\n    keys = Object.keys(namedEntities); //loop over each named entity and replace with the proper equivalent.\n\n    for (i = 0; i < keys.length; i++) {\n      key = keys[i];\n      value = namedEntities[key];\n      regexp = new RegExp(key, \"gi\");\n\n      if (regexp.test(serialized)) {\n        serialized = serialized.replace(regexp, value);\n      }\n    }\n  }\n\n  return serialized;\n};\n/**\n * Returns the root svg\n * @return\n */\n\n\nctx.prototype.getSvg = function () {\n  return this.__root;\n};\n/**\n * Will generate a group tag.\n */\n\n\nctx.prototype.save = function () {\n  var group = this.__createElement(\"g\");\n\n  var parent = this.__closestGroupOrSvg();\n\n  this.__groupStack.push(parent);\n\n  parent.appendChild(group);\n  this.__currentElement = group;\n\n  this.__stack.push(this.__getStyleState());\n};\n/**\n * Sets current element to parent, or just root if already root\n */\n\n\nctx.prototype.restore = function () {\n  this.__currentElement = this.__groupStack.pop();\n  this.__currentElementsToStyle = null; //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\n\n  if (!this.__currentElement) {\n    this.__currentElement = this.__root.childNodes[1];\n  }\n\n  var state = this.__stack.pop();\n\n  this.__applyStyleState(state);\n};\n/**\n * Helper method to add transform\n * @private\n */\n\n\nctx.prototype.__addTransform = function (t) {\n  //if the current element has siblings, add another group\n  var parent = this.__closestGroupOrSvg();\n\n  if (parent.childNodes.length > 0) {\n    if (this.__currentElement.nodeName === \"path\") {\n      if (!this.__currentElementsToStyle) this.__currentElementsToStyle = {\n        element: parent,\n        children: []\n      };\n\n      this.__currentElementsToStyle.children.push(this.__currentElement);\n\n      this.__applyCurrentDefaultPath();\n    }\n\n    var group = this.__createElement(\"g\");\n\n    parent.appendChild(group);\n    this.__currentElement = group;\n  }\n\n  var transform = this.__currentElement.getAttribute(\"transform\");\n\n  if (transform) {\n    transform += \" \";\n  } else {\n    transform = \"\";\n  }\n\n  transform += t;\n\n  this.__currentElement.setAttribute(\"transform\", transform);\n};\n/**\n *  scales the current element\n */\n\n\nctx.prototype.scale = function (x, y) {\n  if (y === undefined) {\n    y = x;\n  }\n\n  this.__addTransform(format(\"scale({x},{y})\", {\n    x: x,\n    y: y\n  }));\n};\n/**\n * rotates the current element\n */\n\n\nctx.prototype.rotate = function (angle) {\n  var degrees = angle * 180 / Math.PI;\n\n  this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {\n    angle: degrees,\n    cx: 0,\n    cy: 0\n  }));\n};\n/**\n * translates the current element\n */\n\n\nctx.prototype.translate = function (x, y) {\n  this.__addTransform(format(\"translate({x},{y})\", {\n    x: x,\n    y: y\n  }));\n};\n/**\n * applies a transform to the current element\n */\n\n\nctx.prototype.transform = function (a, b, c, d, e, f) {\n  this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {\n    a: a,\n    b: b,\n    c: c,\n    d: d,\n    e: e,\n    f: f\n  }));\n};\n/**\n * Create a new Path Element\n */\n\n\nctx.prototype.beginPath = function () {\n  var path, parent; // Note that there is only one current default path, it is not part of the drawing state.\n  // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\n\n  this.__currentDefaultPath = \"\";\n  this.__currentPosition = {};\n  path = this.__createElement(\"path\", {}, true);\n  parent = this.__closestGroupOrSvg();\n  parent.appendChild(path);\n  this.__currentElement = path;\n};\n/**\n * Helper function to apply currentDefaultPath to current path element\n * @private\n */\n\n\nctx.prototype.__applyCurrentDefaultPath = function () {\n  var currentElement = this.__currentElement;\n\n  if (currentElement.nodeName === \"path\") {\n    currentElement.setAttribute(\"d\", this.__currentDefaultPath);\n  } else {\n    console.error(\"Attempted to apply path command to node\", currentElement.nodeName);\n  }\n};\n/**\n * Helper function to add path command\n * @private\n */\n\n\nctx.prototype.__addPathCommand = function (command) {\n  this.__currentDefaultPath += \" \";\n  this.__currentDefaultPath += command;\n};\n/**\n * Adds the move command to the current path element,\n * if the currentPathElement is not empty create a new path element\n */\n\n\nctx.prototype.moveTo = function (x, y) {\n  if (this.__currentElement.nodeName !== \"path\") {\n    this.beginPath();\n  } // creates a new subpath with the given point\n\n\n  this.__currentPosition = {\n    x: x,\n    y: y\n  };\n\n  this.__addPathCommand(format(\"M {x} {y}\", {\n    x: x,\n    y: y\n  }));\n};\n/**\n * Closes the current path\n */\n\n\nctx.prototype.closePath = function () {\n  if (this.__currentDefaultPath) {\n    this.__addPathCommand(\"Z\");\n  }\n};\n/**\n * Adds a line to command\n */\n\n\nctx.prototype.lineTo = function (x, y) {\n  this.__currentPosition = {\n    x: x,\n    y: y\n  };\n\n  if (this.__currentDefaultPath.indexOf('M') > -1) {\n    this.__addPathCommand(format(\"L {x} {y}\", {\n      x: x,\n      y: y\n    }));\n  } else {\n    this.__addPathCommand(format(\"M {x} {y}\", {\n      x: x,\n      y: y\n    }));\n  }\n};\n/**\n * Add a bezier command\n */\n\n\nctx.prototype.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n  this.__currentPosition = {\n    x: x,\n    y: y\n  };\n\n  this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\", {\n    cp1x: cp1x,\n    cp1y: cp1y,\n    cp2x: cp2x,\n    cp2y: cp2y,\n    x: x,\n    y: y\n  }));\n};\n/**\n * Adds a quadratic curve to command\n */\n\n\nctx.prototype.quadraticCurveTo = function (cpx, cpy, x, y) {\n  this.__currentPosition = {\n    x: x,\n    y: y\n  };\n\n  this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {\n    cpx: cpx,\n    cpy: cpy,\n    x: x,\n    y: y\n  }));\n};\n/**\n * Return a new normalized vector of given vector\n */\n\n\nvar normalize = function (vector) {\n  var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\n  return [vector[0] / len, vector[1] / len];\n};\n/**\n * Adds the arcTo to the current path\n *\n * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\n */\n\n\nctx.prototype.arcTo = function (x1, y1, x2, y2, radius) {\n  // Let the point (x0, y0) be the last point in the subpath.\n  var x0 = this.__currentPosition && this.__currentPosition.x;\n  var y0 = this.__currentPosition && this.__currentPosition.y; // First ensure there is a subpath for (x1, y1).\n\n  if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\n    return;\n  } // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\n\n\n  if (radius < 0) {\n    throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\n  } // If the point (x0, y0) is equal to the point (x1, y1),\n  // or if the point (x1, y1) is equal to the point (x2, y2),\n  // or if the radius radius is zero,\n  // then the method must add the point (x1, y1) to the subpath,\n  // and connect that point to the previous point (x0, y0) by a straight line.\n\n\n  if (x0 === x1 && y0 === y1 || x1 === x2 && y1 === y2 || radius === 0) {\n    this.lineTo(x1, y1);\n    return;\n  } // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\n  // then the method must add the point (x1, y1) to the subpath,\n  // and connect that point to the previous point (x0, y0) by a straight line.\n\n\n  var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\n  var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\n\n  if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\n    this.lineTo(x1, y1);\n    return;\n  } // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\n  // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\n  // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\n  // The points at which this circle touches these two lines are called the start and end tangent points respectively.\n  // note that both vectors are unit vectors, so the length is 1\n\n\n  var cos = unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1];\n  var theta = Math.acos(Math.abs(cos)); // Calculate origin\n\n  var unit_vec_p1_origin = normalize([unit_vec_p1_p0[0] + unit_vec_p1_p2[0], unit_vec_p1_p0[1] + unit_vec_p1_p2[1]]);\n  var len_p1_origin = radius / Math.sin(theta / 2);\n  var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\n  var y = y1 + len_p1_origin * unit_vec_p1_origin[1]; // Calculate start angle and end angle\n  // rotate 90deg clockwise (note that y axis points to its down)\n\n  var unit_vec_origin_start_tangent = [-unit_vec_p1_p0[1], unit_vec_p1_p0[0]]; // rotate 90deg counter clockwise (note that y axis points to its down)\n\n  var unit_vec_origin_end_tangent = [unit_vec_p1_p2[1], -unit_vec_p1_p2[0]];\n\n  var getAngle = function (vector) {\n    // get angle (clockwise) between vector and (1, 0)\n    var x = vector[0];\n    var y = vector[1];\n\n    if (y >= 0) {\n      // note that y axis points to its down\n      return Math.acos(x);\n    } else {\n      return -Math.acos(x);\n    }\n  };\n\n  var startAngle = getAngle(unit_vec_origin_start_tangent);\n  var endAngle = getAngle(unit_vec_origin_end_tangent); // Connect the point (x0, y0) to the start tangent point by a straight line\n\n  this.lineTo(x + unit_vec_origin_start_tangent[0] * radius, y + unit_vec_origin_start_tangent[1] * radius); // Connect the start tangent point to the end tangent point by arc\n  // and adding the end tangent point to the subpath.\n\n  this.arc(x, y, radius, startAngle, endAngle);\n};\n/**\n * Sets the stroke property on the current element\n */\n\n\nctx.prototype.stroke = function () {\n  if (this.__currentElement.nodeName === \"path\") {\n    this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\n  }\n\n  this.__applyCurrentDefaultPath();\n\n  this.__applyStyleToCurrentElement(\"stroke\");\n};\n/**\n * Sets fill properties on the current element\n */\n\n\nctx.prototype.fill = function () {\n  if (this.__currentElement.nodeName === \"path\") {\n    this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\n  }\n\n  this.__applyCurrentDefaultPath();\n\n  this.__applyStyleToCurrentElement(\"fill\");\n};\n/**\n *  Adds a rectangle to the path.\n */\n\n\nctx.prototype.rect = function (x, y, width, height) {\n  if (this.__currentElement.nodeName !== \"path\") {\n    this.beginPath();\n  }\n\n  this.moveTo(x, y);\n  this.lineTo(x + width, y);\n  this.lineTo(x + width, y + height);\n  this.lineTo(x, y + height);\n  this.lineTo(x, y);\n  this.closePath();\n};\n/**\n * adds a rectangle element\n */\n\n\nctx.prototype.fillRect = function (x, y, width, height) {\n  var rect, parent;\n  rect = this.__createElement(\"rect\", {\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  }, true);\n  parent = this.__closestGroupOrSvg();\n  parent.appendChild(rect);\n  this.__currentElement = rect;\n\n  this.__applyStyleToCurrentElement(\"fill\");\n};\n/**\n * Draws a rectangle with no fill\n * @param x\n * @param y\n * @param width\n * @param height\n */\n\n\nctx.prototype.strokeRect = function (x, y, width, height) {\n  var rect, parent;\n  rect = this.__createElement(\"rect\", {\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  }, true);\n  parent = this.__closestGroupOrSvg();\n  parent.appendChild(rect);\n  this.__currentElement = rect;\n\n  this.__applyStyleToCurrentElement(\"stroke\");\n};\n/**\n * Clear entire canvas:\n * 1. save current transforms\n * 2. remove all the childNodes of the root g element\n */\n\n\nctx.prototype.__clearCanvas = function () {\n  var current = this.__closestGroupOrSvg(),\n      transform = current.getAttribute(\"transform\");\n\n  var rootGroup = this.__root.childNodes[1];\n  var childNodes = rootGroup.childNodes;\n\n  for (var i = childNodes.length - 1; i >= 0; i--) {\n    if (childNodes[i]) {\n      rootGroup.removeChild(childNodes[i]);\n    }\n  }\n\n  this.__currentElement = rootGroup; //reset __groupStack as all the child group nodes are all removed.\n\n  this.__groupStack = [];\n\n  if (transform) {\n    this.__addTransform(transform);\n  }\n};\n/**\n * \"Clears\" a canvas by just drawing a white rectangle in the current group.\n */\n\n\nctx.prototype.clearRect = function (x, y, width, height) {\n  //clear entire canvas\n  if (x === 0 && y === 0 && width === this.width && height === this.height) {\n    this.__clearCanvas();\n\n    return;\n  }\n\n  var rect,\n      parent = this.__closestGroupOrSvg();\n\n  rect = this.__createElement(\"rect\", {\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    fill: \"#FFFFFF\"\n  }, true);\n  parent.appendChild(rect);\n};\n/**\n * Adds a linear gradient to a defs tag.\n * Returns a canvas gradient object that has a reference to it's parent def\n */\n\n\nctx.prototype.createLinearGradient = function (x1, y1, x2, y2) {\n  var grad = this.__createElement(\"linearGradient\", {\n    id: randomString(this.__ids),\n    x1: x1 + \"px\",\n    x2: x2 + \"px\",\n    y1: y1 + \"px\",\n    y2: y2 + \"px\",\n    \"gradientUnits\": \"userSpaceOnUse\"\n  }, false);\n\n  this.__defs.appendChild(grad);\n\n  return new CanvasGradient(grad, this);\n};\n/**\n * Adds a radial gradient to a defs tag.\n * Returns a canvas gradient object that has a reference to it's parent def\n */\n\n\nctx.prototype.createRadialGradient = function (x0, y0, r0, x1, y1, r1) {\n  var grad = this.__createElement(\"radialGradient\", {\n    id: randomString(this.__ids),\n    cx: x1 + \"px\",\n    cy: y1 + \"px\",\n    r: r1 + \"px\",\n    fx: x0 + \"px\",\n    fy: y0 + \"px\",\n    \"gradientUnits\": \"userSpaceOnUse\"\n  }, false);\n\n  this.__defs.appendChild(grad);\n\n  return new CanvasGradient(grad, this);\n};\n/**\n * Parses the font string and returns svg mapping\n * @private\n */\n\n\nctx.prototype.__parseFont = function () {\n  var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\n  var fontPart = regex.exec(this.font);\n  var data = {\n    style: fontPart[1] || 'normal',\n    size: fontPart[4] || '10px',\n    family: fontPart[6] || 'sans-serif',\n    weight: fontPart[3] || 'normal',\n    decoration: fontPart[2] || 'normal',\n    href: null\n  }; //canvas doesn't support underline natively, but we can pass this attribute\n\n  if (this.__fontUnderline === \"underline\") {\n    data.decoration = \"underline\";\n  } //canvas also doesn't support linking, but we can pass this as well\n\n\n  if (this.__fontHref) {\n    data.href = this.__fontHref;\n  }\n\n  return data;\n};\n/**\n * Helper to link text fragments\n * @param font\n * @param element\n * @return {*}\n * @private\n */\n\n\nctx.prototype.__wrapTextLink = function (font, element) {\n  if (font.href) {\n    var a = this.__createElement(\"a\");\n\n    a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\n    a.appendChild(element);\n    return a;\n  }\n\n  return element;\n};\n/**\n * Fills or strokes text\n * @param text\n * @param x\n * @param y\n * @param action - stroke or fill\n * @private\n */\n\n\nctx.prototype.__applyText = function (text, x, y, action) {\n  var font = this.__parseFont(),\n      parent = this.__closestGroupOrSvg(),\n      textElement = this.__createElement(\"text\", {\n    \"font-family\": font.family,\n    \"font-size\": font.size,\n    \"font-style\": font.style,\n    \"font-weight\": font.weight,\n    \"text-decoration\": font.decoration,\n    \"x\": x,\n    \"y\": y,\n    \"text-anchor\": getTextAnchor(this.textAlign),\n    \"dominant-baseline\": getDominantBaseline(this.textBaseline)\n  }, true);\n\n  textElement.appendChild(this.__document.createTextNode(text));\n  this.__currentElement = textElement;\n\n  this.__applyStyleToCurrentElement(action);\n\n  parent.appendChild(this.__wrapTextLink(font, textElement));\n};\n/**\n * Creates a text element\n * @param text\n * @param x\n * @param y\n */\n\n\nctx.prototype.fillText = function (text, x, y) {\n  this.__applyText(text, x, y, \"fill\");\n};\n/**\n * Strokes text\n * @param text\n * @param x\n * @param y\n */\n\n\nctx.prototype.strokeText = function (text, x, y) {\n  this.__applyText(text, x, y, \"stroke\");\n};\n/**\n * No need to implement this for svg.\n * @param text\n * @return {TextMetrics}\n */\n\n\nctx.prototype.measureText = function (text) {\n  this.__ctx.font = this.font;\n  return this.__ctx.measureText(text);\n};\n/**\n *  Arc command!\n */\n\n\nctx.prototype.arc = function (x, y, radius, startAngle, endAngle, counterClockwise) {\n  // in canvas no circle is drawn if no angle is provided.\n  if (startAngle === endAngle) {\n    return;\n  }\n\n  startAngle = startAngle % (2 * Math.PI);\n  endAngle = endAngle % (2 * Math.PI);\n\n  if (startAngle === endAngle) {\n    //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\n    endAngle = (endAngle + 2 * Math.PI - 0.001 * (counterClockwise ? -1 : 1)) % (2 * Math.PI);\n  }\n\n  var endX = x + radius * Math.cos(endAngle),\n      endY = y + radius * Math.sin(endAngle),\n      startX = x + radius * Math.cos(startAngle),\n      startY = y + radius * Math.sin(startAngle),\n      sweepFlag = counterClockwise ? 0 : 1,\n      largeArcFlag = 0,\n      diff = endAngle - startAngle; // https://github.com/gliffy/canvas2svg/issues/4\n\n  if (diff < 0) {\n    diff += 2 * Math.PI;\n  }\n\n  if (counterClockwise) {\n    largeArcFlag = diff > Math.PI ? 0 : 1;\n  } else {\n    largeArcFlag = diff > Math.PI ? 1 : 0;\n  }\n\n  this.lineTo(startX, startY);\n\n  this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\", {\n    rx: radius,\n    ry: radius,\n    xAxisRotation: 0,\n    largeArcFlag: largeArcFlag,\n    sweepFlag: sweepFlag,\n    endX: endX,\n    endY: endY\n  }));\n\n  this.__currentPosition = {\n    x: endX,\n    y: endY\n  };\n};\n/**\n * Generates a ClipPath from the clip command.\n */\n\n\nctx.prototype.clip = function () {\n  var group = this.__closestGroupOrSvg(),\n      clipPath = this.__createElement(\"clipPath\"),\n      id = randomString(this.__ids),\n      newGroup = this.__createElement(\"g\");\n\n  this.__applyCurrentDefaultPath();\n\n  group.removeChild(this.__currentElement);\n  clipPath.setAttribute(\"id\", id);\n  clipPath.appendChild(this.__currentElement);\n\n  this.__defs.appendChild(clipPath); //set the clip path to this group\n\n\n  group.setAttribute(\"clip-path\", format(\"url(#{id})\", {\n    id: id\n  })); //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\n  // to this path\n\n  group.appendChild(newGroup);\n  this.__currentElement = newGroup;\n};\n/**\n * Draws a canvas, image or mock context to this canvas.\n * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\n * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\n */\n\n\nctx.prototype.drawImage = function () {\n  //convert arguments to a real array\n  var args = Array.prototype.slice.call(arguments),\n      image = args[0],\n      dx,\n      dy,\n      dw,\n      dh,\n      sx = 0,\n      sy = 0,\n      sw,\n      sh,\n      parent,\n      svg,\n      defs,\n      group,\n      currentElement,\n      svgImage,\n      canvas,\n      context,\n      id;\n\n  if (args.length === 3) {\n    dx = args[1];\n    dy = args[2];\n    sw = image.width;\n    sh = image.height;\n    dw = sw;\n    dh = sh;\n  } else if (args.length === 5) {\n    dx = args[1];\n    dy = args[2];\n    dw = args[3];\n    dh = args[4];\n    sw = image.width;\n    sh = image.height;\n  } else if (args.length === 9) {\n    sx = args[1];\n    sy = args[2];\n    sw = args[3];\n    sh = args[4];\n    dx = args[5];\n    dy = args[6];\n    dw = args[7];\n    dh = args[8];\n  } else {\n    throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\n  }\n\n  parent = this.__closestGroupOrSvg();\n  currentElement = this.__currentElement;\n  var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\n\n  if (image instanceof ctx) {\n    //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\n    //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\n    svg = image.getSvg().cloneNode(true);\n\n    if (svg.childNodes && svg.childNodes.length > 1) {\n      defs = svg.childNodes[0];\n\n      while (defs.childNodes.length) {\n        id = defs.childNodes[0].getAttribute(\"id\");\n        this.__ids[id] = id;\n\n        this.__defs.appendChild(defs.childNodes[0]);\n      }\n\n      group = svg.childNodes[1];\n\n      if (group) {\n        //save original transform\n        var originTransform = group.getAttribute(\"transform\");\n        var transformDirective;\n\n        if (originTransform) {\n          transformDirective = originTransform + \" \" + translateDirective;\n        } else {\n          transformDirective = translateDirective;\n        }\n\n        group.setAttribute(\"transform\", transformDirective);\n        parent.appendChild(group);\n      }\n    }\n  } else if (image.nodeName === \"IMG\") {\n    svgImage = this.__createElement(\"image\");\n    svgImage.setAttribute(\"width\", dw);\n    svgImage.setAttribute(\"height\", dh);\n    svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\n\n    if (sx || sy || sw !== image.width || sh !== image.height) {\n      //crop the image using a temporary canvas\n      canvas = this.__document.createElement(\"canvas\");\n      canvas.width = dw;\n      canvas.height = dh;\n      context = canvas.getContext(\"2d\");\n      context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\n      image = canvas;\n    }\n\n    svgImage.setAttribute(\"transform\", translateDirective);\n    svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\n    parent.appendChild(svgImage);\n  } else if (image.nodeName === \"CANVAS\") {\n    svgImage = this.__createElement(\"image\");\n    svgImage.setAttribute(\"width\", dw);\n    svgImage.setAttribute(\"height\", dh);\n    svgImage.setAttribute(\"preserveAspectRatio\", \"none\"); // draw canvas onto temporary canvas so that smoothing can be handled\n\n    canvas = this.__document.createElement(\"canvas\");\n    canvas.width = dw;\n    canvas.height = dh;\n    context = canvas.getContext(\"2d\");\n    context.imageSmoothingEnabled = false;\n    context.mozImageSmoothingEnabled = false;\n    context.oImageSmoothingEnabled = false;\n    context.webkitImageSmoothingEnabled = false;\n    context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\n    image = canvas;\n    svgImage.setAttribute(\"transform\", translateDirective);\n    svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", image.toDataURL());\n    parent.appendChild(svgImage);\n  }\n};\n/**\n * Generates a pattern tag\n */\n\n\nctx.prototype.createPattern = function (image, repetition) {\n  var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"),\n      id = randomString(this.__ids),\n      img;\n\n  pattern.setAttribute(\"id\", id);\n  pattern.setAttribute(\"width\", image.width);\n  pattern.setAttribute(\"height\", image.height);\n\n  if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\n    img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n    img.setAttribute(\"width\", image.width);\n    img.setAttribute(\"height\", image.height);\n    img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\n    pattern.appendChild(img);\n\n    this.__defs.appendChild(pattern);\n  } else if (image instanceof ctx) {\n    pattern.appendChild(image.__root.childNodes[1]);\n\n    this.__defs.appendChild(pattern);\n  }\n\n  return new CanvasPattern(pattern, this);\n};\n\nctx.prototype.setLineDash = function (dashArray) {\n  if (dashArray && dashArray.length > 0) {\n    this.lineDash = dashArray.join(\",\");\n  } else {\n    this.lineDash = null;\n  }\n};\n/**\n * Not yet implemented\n */\n\n\nctx.prototype.drawFocusRing = function () {};\n\nctx.prototype.createImageData = function () {};\n\nctx.prototype.getImageData = function () {};\n\nctx.prototype.putImageData = function () {};\n\nctx.prototype.globalCompositeOperation = function () {};\n\nctx.prototype.setTransform = function () {};\n\nexport default ctx;","map":{"version":3,"sources":["/Users/gen/Desktop/defund_to_refund/node_modules/@bokeh/canvas2svg/canvas2svg.js"],"names":["STYLES","ctx","CanvasGradient","CanvasPattern","namedEntities","format","str","args","keys","Object","i","length","replace","RegExp","randomString","holder","chars","randomstring","Error","Math","floor","random","createNamedToNumberedLookup","items","radix","entity","lookup","base10","base16","split","parseInt","getTextAnchor","textAlign","mapping","start","getDominantBaseline","textBaseline","alphabetic","svgAttr","canvas","svg","apply","gradientNode","__root","__ctx","prototype","addColorStop","offset","color","stop","__createElement","regex","matches","setAttribute","indexOf","exec","r","g","b","appendChild","pattern","o","defaultOptions","width","height","enableMirroring","options","arguments","undefined","__document","document","__canvas","createElement","getContext","__setDefaultStyles","__stack","__getStyleState","__groupStack","createElementNS","setAttributeNS","__ids","__defs","__currentElement","elementName","properties","resetFill","element","key","__applyStyleState","styleState","__applyStyleToCurrentElement","type","currentElement","currentStyleGroup","__currentElementsToStyle","children","forEach","node","style","value","id","childNodes","getAttribute","opacity","globalAlpha","attr","__closestGroupOrSvg","nodeName","parentNode","getSerializedSvg","fixNamedEntities","serialized","XMLSerializer","serializeToString","regexp","xmlns","test","getSvg","save","group","parent","push","restore","pop","state","__addTransform","t","__applyCurrentDefaultPath","transform","scale","x","y","rotate","angle","degrees","PI","cx","cy","translate","a","c","d","e","f","beginPath","path","__currentDefaultPath","__currentPosition","console","error","__addPathCommand","command","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","normalize","vector","len","sqrt","arcTo","x1","y1","x2","y2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","cos","theta","acos","abs","unit_vec_p1_origin","len_p1_origin","sin","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","__clearCanvas","current","rootGroup","removeChild","clearRect","createLinearGradient","grad","createRadialGradient","r0","r1","fx","fy","__parseFont","fontPart","font","data","size","family","weight","decoration","href","__fontUnderline","__fontHref","__wrapTextLink","__applyText","text","action","textElement","createTextNode","fillText","strokeText","measureText","counterClockwise","endX","endY","startX","startY","sweepFlag","largeArcFlag","diff","rx","ry","xAxisRotation","clip","clipPath","newGroup","drawImage","Array","slice","call","image","dx","dy","dw","dh","sx","sy","sw","sh","defs","svgImage","context","translateDirective","cloneNode","originTransform","transformDirective","toDataURL","imageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","webkitImageSmoothingEnabled","createPattern","repetition","img","setLineDash","dashArray","lineDash","join","drawFocusRing","createImageData","getImageData","putImageData","globalCompositeOperation","setTransform"],"mappings":"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","sourcesContent":["/*!!\n *  Canvas 2 Svg v1.0.21\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\n *\n *  Licensed under the MIT license:\n *  http://www.opensource.org/licenses/mit-license.php\n *\n *  Author:\n *  Kerry Liu\n *\n *  Copyright (c) 2014 Gliffy Inc.\n */\n\n    var STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities;\n\n    //helper function to format a string\n    function format(str, args) {\n        var keys = Object.keys(args), i;\n        for (i=0; i<keys.length; i++) {\n            str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\n        }\n        return str;\n    }\n\n    //helper function that generates a random string\n    function randomString(holder) {\n        var chars, randomstring, i;\n        if (!holder) {\n            throw new Error(\"cannot create a random attribute name for an undefined object\");\n        }\n        chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\n        randomstring = \"\";\n        do {\n            randomstring = \"\";\n            for (i = 0; i < 12; i++) {\n                randomstring += chars[Math.floor(Math.random() * chars.length)];\n            }\n        } while (holder[randomstring]);\n        return randomstring;\n    }\n\n    //helper function to map named to numbered entities\n    function createNamedToNumberedLookup(items, radix) {\n        var i, entity, lookup = {}, base10, base16;\n        items = items.split(',');\n        radix = radix || 10;\n        // Map from named to numbered entities.\n        for (i = 0; i < items.length; i += 2) {\n            entity = '&' + items[i + 1] + ';';\n            base10 = parseInt(items[i], radix);\n            lookup[entity] = '&#'+base10+';';\n        }\n        //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\n        lookup[\"\\\\xa0\"] = '&#160;';\n        return lookup;\n    }\n\n    //helper function to map canvas-textAlign to svg-textAnchor\n    function getTextAnchor(textAlign) {\n        //TODO: support rtl languages\n        var mapping = {\"left\":\"start\", \"right\":\"end\", \"center\":\"middle\", \"start\":\"start\", \"end\":\"end\"};\n        return mapping[textAlign] || mapping.start;\n    }\n\n    //helper function to map canvas-textBaseline to svg-dominantBaseline\n    function getDominantBaseline(textBaseline) {\n        //INFO: not supported in all browsers\n        var mapping = {\"alphabetic\": \"alphabetic\", \"hanging\": \"hanging\", \"top\":\"text-before-edge\", \"bottom\":\"text-after-edge\", \"middle\":\"central\"};\n        return mapping[textBaseline] || mapping.alphabetic;\n    }\n\n    // Unpack entities lookup where the numbers are in radix 32 to reduce the size\n    // entity mapping courtesy of tinymce\n    namedEntities = createNamedToNumberedLookup(\n        '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\n            '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\n            '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\n            '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\n            '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\n            '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\n            '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\n            '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\n            '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\n            '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\n            'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\n            'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\n            't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\n            'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\n            'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\n            '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\n            '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\n            '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\n            '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\n            '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\n            'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\n            'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\n            'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\n            '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\n            '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n\n    //Some basic mappings for attributes and default values.\n    STYLES = {\n        \"strokeStyle\":{\n            svgAttr : \"stroke\", //corresponding svg attribute\n            canvas : \"#000000\", //canvas default\n            svg : \"none\",       //svg default\n            apply : \"stroke\"    //apply on stroke() or fill()\n        },\n        \"fillStyle\":{\n            svgAttr : \"fill\",\n            canvas : \"#000000\",\n            svg : null, //svg default is black, but we need to special case this to handle canvas stroke without fill\n            apply : \"fill\"\n        },\n        \"lineCap\":{\n            svgAttr : \"stroke-linecap\",\n            canvas : \"butt\",\n            svg : \"butt\",\n            apply : \"stroke\"\n        },\n        \"lineJoin\":{\n            svgAttr : \"stroke-linejoin\",\n            canvas : \"miter\",\n            svg : \"miter\",\n            apply : \"stroke\"\n        },\n        \"miterLimit\":{\n            svgAttr : \"stroke-miterlimit\",\n            canvas : 10,\n            svg : 4,\n            apply : \"stroke\"\n        },\n        \"lineWidth\":{\n            svgAttr : \"stroke-width\",\n            canvas : 1,\n            svg : 1,\n            apply : \"stroke\"\n        },\n        \"globalAlpha\": {\n            svgAttr : \"opacity\",\n            canvas : 1,\n            svg : 1,\n            apply :  \"fill stroke\"\n        },\n        \"font\":{\n            //font converts to multiple svg attributes, there is custom logic for this\n            canvas : \"10px sans-serif\"\n        },\n        \"shadowColor\":{\n            canvas : \"#000000\"\n        },\n        \"shadowOffsetX\":{\n            canvas : 0\n        },\n        \"shadowOffsetY\":{\n            canvas : 0\n        },\n        \"shadowBlur\":{\n            canvas : 0\n        },\n        \"textAlign\":{\n            canvas : \"start\"\n        },\n        \"textBaseline\":{\n            canvas : \"alphabetic\"\n        },\n        \"lineDash\" : {\n            svgAttr : \"stroke-dasharray\",\n            canvas : [],\n            svg : null,\n            apply : \"stroke\"\n        }\n    };\n\n    /**\n     *\n     * @param gradientNode - reference to the gradient\n     * @constructor\n     */\n    CanvasGradient = function (gradientNode, ctx) {\n        this.__root = gradientNode;\n        this.__ctx = ctx;\n    };\n\n    /**\n     * Adds a color stop to the gradient root\n     */\n    CanvasGradient.prototype.addColorStop = function (offset, color) {\n        var stop = this.__ctx.__createElement(\"stop\"), regex, matches;\n        stop.setAttribute(\"offset\", offset);\n        if (color.indexOf(\"rgba\") !== -1) {\n            //separate alpha value, since webkit can't handle it\n            regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n            matches = regex.exec(color);\n            stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\n            stop.setAttribute(\"stop-opacity\", matches[4]);\n        } else {\n            stop.setAttribute(\"stop-color\", color);\n        }\n        this.__root.appendChild(stop);\n    };\n\n    CanvasPattern = function (pattern, ctx) {\n        this.__root = pattern;\n        this.__ctx = ctx;\n    };\n\n    /**\n     * The mock canvas context\n     * @param o - options include:\n     * ctx - existing Context2D to wrap around\n     * width - width of your canvas (defaults to 500)\n     * height - height of your canvas (defaults to 500)\n     * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\n     * document - the document object (defaults to the current document)\n     */\n    ctx = function (o) {\n        var defaultOptions = { width:500, height:500, enableMirroring : false}, options;\n\n        //keep support for this way of calling C2S: new C2S(width,height)\n        if (arguments.length > 1) {\n            options = defaultOptions;\n            options.width = arguments[0];\n            options.height = arguments[1];\n        } else if ( !o ) {\n            options = defaultOptions;\n        } else {\n            options = o;\n        }\n\n        if (!(this instanceof ctx)) {\n            //did someone call this without new?\n            return new ctx(options);\n        }\n\n        //setup options\n        this.width = options.width || defaultOptions.width;\n        this.height = options.height || defaultOptions.height;\n        this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\n\n        this.canvas = this;   ///point back to this instance!\n        this.__document = options.document || document;\n\n        // allow passing in an existing context to wrap around\n        // if a context is passed in, we know a canvas already exist\n        if (options.ctx) {\n            this.__ctx = options.ctx;\n        } else {\n            this.__canvas = this.__document.createElement(\"canvas\");\n            this.__ctx = this.__canvas.getContext(\"2d\");\n        }\n\n        this.__setDefaultStyles();\n        this.__stack = [this.__getStyleState()];\n        this.__groupStack = [];\n\n        //the root svg element\n        this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n        this.__root.setAttribute(\"version\", 1.1);\n        this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n        this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n        this.__root.setAttribute(\"width\", this.width);\n        this.__root.setAttribute(\"height\", this.height);\n\n        //make sure we don't generate the same ids in defs\n        this.__ids = {};\n\n        //defs tag\n        this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n        this.__root.appendChild(this.__defs);\n\n        //also add a group child. the svg element can't use the transform attribute\n        this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n        this.__root.appendChild(this.__currentElement);\n    };\n\n\n    /**\n     * Creates the specified svg element\n     * @private\n     */\n    ctx.prototype.__createElement = function (elementName, properties, resetFill) {\n        if (typeof properties === \"undefined\") {\n            properties = {};\n        }\n\n        var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\n            keys = Object.keys(properties), i, key;\n        if (resetFill) {\n            //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\n            element.setAttribute(\"fill\", \"none\");\n            element.setAttribute(\"stroke\", \"none\");\n        }\n        for (i=0; i<keys.length; i++) {\n            key = keys[i];\n            element.setAttribute(key, properties[key]);\n        }\n        return element;\n    };\n\n    /**\n     * Applies default canvas styles to the context\n     * @private\n     */\n    ctx.prototype.__setDefaultStyles = function () {\n        //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\n        var keys = Object.keys(STYLES), i, key;\n        for (i=0; i<keys.length; i++) {\n            key = keys[i];\n            this[key] = STYLES[key].canvas;\n        }\n    };\n\n    /**\n     * Applies styles on restore\n     * @param styleState\n     * @private\n     */\n    ctx.prototype.__applyStyleState = function (styleState) {\n        var keys = Object.keys(styleState), i, key;\n        for (i=0; i<keys.length; i++) {\n            key = keys[i];\n            this[key] = styleState[key];\n        }\n    };\n\n    /**\n     * Gets the current style state\n     * @return {Object}\n     * @private\n     */\n    ctx.prototype.__getStyleState = function () {\n        var i, styleState = {}, keys = Object.keys(STYLES), key;\n        for (i=0; i<keys.length; i++) {\n            key = keys[i];\n            styleState[key] = this[key];\n        }\n        return styleState;\n    };\n\n    /**\n     * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\n     * @param type\n     * @private\n     */\n    ctx.prototype.__applyStyleToCurrentElement = function (type) {\n    \tvar currentElement = this.__currentElement;\n    \tvar currentStyleGroup = this.__currentElementsToStyle;\n    \tif (currentStyleGroup) {\n    \t\tcurrentElement.setAttribute(type, \"\");\n    \t\tcurrentElement = currentStyleGroup.element;\n    \t\tcurrentStyleGroup.children.forEach(function (node) {\n    \t\t\tnode.setAttribute(type, \"\");\n    \t\t})\n    \t}\n\n        var keys = Object.keys(STYLES), i, style, value, id, regex, matches;\n        for (i = 0; i < keys.length; i++) {\n            style = STYLES[keys[i]];\n            value = this[keys[i]];\n            if (style.apply) {\n                //is this a gradient or pattern?\n                if (value instanceof CanvasPattern) {\n                    //pattern\n                    if (value.__ctx) {\n                        //copy over defs\n                        while(value.__ctx.__defs.childNodes.length) {\n                            id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\n                            this.__ids[id] = id;\n                            this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\n                        }\n                    }\n                    currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\n                }\n                else if (value instanceof CanvasGradient) {\n                    //gradient\n                    currentElement.setAttribute(style.apply, format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\n                } else if (style.apply.indexOf(type)!==-1 && style.svg !== value) {\n                    if ((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\n                        //separate alpha value, since illustrator can't handle it\n                        regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n                        matches = regex.exec(value);\n                        currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\n                        //should take globalAlpha here\n                        var opacity = matches[4];\n                        var globalAlpha = this.globalAlpha;\n                        if (globalAlpha != null) {\n                            opacity *= globalAlpha;\n                        }\n                        currentElement.setAttribute(style.svgAttr+\"-opacity\", opacity);\n                    } else {\n                        var attr = style.svgAttr;\n                        if (keys[i] === 'globalAlpha') {\n                            attr = type+'-'+style.svgAttr;\n                            if (currentElement.getAttribute(attr)) {\n                                 //fill-opacity or stroke-opacity has already been set by stroke or fill.\n                                continue;\n                            }\n                        }\n                        //otherwise only update attribute if right type, and not svg default\n                        currentElement.setAttribute(attr, value);\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * Will return the closest group or svg node. May return the current element.\n     * @private\n     */\n    ctx.prototype.__closestGroupOrSvg = function (node) {\n        node = node || this.__currentElement;\n        if (node.nodeName === \"g\" || node.nodeName === \"svg\") {\n            return node;\n        } else {\n            return this.__closestGroupOrSvg(node.parentNode);\n        }\n    };\n\n    /**\n     * Returns the serialized value of the svg so far\n     * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\n     *                           If true, we attempt to find all named entities and encode it as a numeric entity.\n     * @return serialized svg\n     */\n    ctx.prototype.getSerializedSvg = function (fixNamedEntities) {\n        var serialized = new XMLSerializer().serializeToString(this.__root),\n            keys, i, key, value, regexp, xmlns;\n\n        //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\n        xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\n        if (xmlns.test(serialized)) {\n            serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg','xmlns:xlink=\"http://www.w3.org/1999/xlink');\n        }\n\n        if (fixNamedEntities) {\n            keys = Object.keys(namedEntities);\n            //loop over each named entity and replace with the proper equivalent.\n            for (i=0; i<keys.length; i++) {\n                key = keys[i];\n                value = namedEntities[key];\n                regexp = new RegExp(key, \"gi\");\n                if (regexp.test(serialized)) {\n                    serialized = serialized.replace(regexp, value);\n                }\n            }\n        }\n\n        return serialized;\n    };\n\n\n    /**\n     * Returns the root svg\n     * @return\n     */\n    ctx.prototype.getSvg = function () {\n        return this.__root;\n    };\n    /**\n     * Will generate a group tag.\n     */\n    ctx.prototype.save = function () {\n        var group = this.__createElement(\"g\");\n        var parent = this.__closestGroupOrSvg();\n        this.__groupStack.push(parent);\n        parent.appendChild(group);\n        this.__currentElement = group;\n        this.__stack.push(this.__getStyleState());\n    };\n    /**\n     * Sets current element to parent, or just root if already root\n     */\n    ctx.prototype.restore = function () {\n        this.__currentElement = this.__groupStack.pop();\n        this.__currentElementsToStyle = null;\n        //Clearing canvas will make the poped group invalid, currentElement is set to the root group node.\n        if (!this.__currentElement) {\n            this.__currentElement = this.__root.childNodes[1];\n        }\n        var state = this.__stack.pop();\n        this.__applyStyleState(state);\n    };\n\n    /**\n     * Helper method to add transform\n     * @private\n     */\n    ctx.prototype.__addTransform = function (t) {\n        //if the current element has siblings, add another group\n        var parent = this.__closestGroupOrSvg();\n        if (parent.childNodes.length > 0) {\n        \tif (this.__currentElement.nodeName === \"path\") {\n        \t\tif (!this.__currentElementsToStyle) this.__currentElementsToStyle = {element: parent, children: []};\n        \t\tthis.__currentElementsToStyle.children.push(this.__currentElement)\n        \t\tthis.__applyCurrentDefaultPath();\n        \t}\n\n            var group = this.__createElement(\"g\");\n            parent.appendChild(group);\n            this.__currentElement = group;\n        }\n\n        var transform = this.__currentElement.getAttribute(\"transform\");\n        if (transform) {\n            transform += \" \";\n        } else {\n            transform = \"\";\n        }\n        transform += t;\n        this.__currentElement.setAttribute(\"transform\", transform);\n    };\n\n    /**\n     *  scales the current element\n     */\n    ctx.prototype.scale = function (x, y) {\n        if (y === undefined) {\n            y = x;\n        }\n        this.__addTransform(format(\"scale({x},{y})\", {x:x, y:y}));\n    };\n\n    /**\n     * rotates the current element\n     */\n    ctx.prototype.rotate = function (angle) {\n        var degrees = (angle * 180 / Math.PI);\n        this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {angle:degrees, cx:0, cy:0}));\n    };\n\n    /**\n     * translates the current element\n     */\n    ctx.prototype.translate = function (x, y) {\n        this.__addTransform(format(\"translate({x},{y})\", {x:x,y:y}));\n    };\n\n    /**\n     * applies a transform to the current element\n     */\n    ctx.prototype.transform = function (a, b, c, d, e, f) {\n        this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {a:a, b:b, c:c, d:d, e:e, f:f}));\n    };\n\n    /**\n     * Create a new Path Element\n     */\n    ctx.prototype.beginPath = function () {\n        var path, parent;\n\n        // Note that there is only one current default path, it is not part of the drawing state.\n        // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\n        this.__currentDefaultPath = \"\";\n        this.__currentPosition = {};\n\n        path = this.__createElement(\"path\", {}, true);\n        parent = this.__closestGroupOrSvg();\n        parent.appendChild(path);\n        this.__currentElement = path;\n    };\n\n    /**\n     * Helper function to apply currentDefaultPath to current path element\n     * @private\n     */\n    ctx.prototype.__applyCurrentDefaultPath = function () {\n    \tvar currentElement = this.__currentElement;\n        if (currentElement.nodeName === \"path\") {\n\t\t\tcurrentElement.setAttribute(\"d\", this.__currentDefaultPath);\n        } else {\n\t\t\tconsole.error(\"Attempted to apply path command to node\", currentElement.nodeName);\n        }\n    };\n\n    /**\n     * Helper function to add path command\n     * @private\n     */\n    ctx.prototype.__addPathCommand = function (command) {\n        this.__currentDefaultPath += \" \";\n        this.__currentDefaultPath += command;\n    };\n\n    /**\n     * Adds the move command to the current path element,\n     * if the currentPathElement is not empty create a new path element\n     */\n    ctx.prototype.moveTo = function (x,y) {\n        if (this.__currentElement.nodeName !== \"path\") {\n            this.beginPath();\n        }\n\n        // creates a new subpath with the given point\n        this.__currentPosition = {x: x, y: y};\n        this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\n    };\n\n    /**\n     * Closes the current path\n     */\n    ctx.prototype.closePath = function () {\n        if (this.__currentDefaultPath) {\n            this.__addPathCommand(\"Z\");\n        }\n    };\n\n    /**\n     * Adds a line to command\n     */\n    ctx.prototype.lineTo = function (x, y) {\n        this.__currentPosition = {x: x, y: y};\n        if (this.__currentDefaultPath.indexOf('M') > -1) {\n            this.__addPathCommand(format(\"L {x} {y}\", {x:x, y:y}));\n        } else {\n            this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\n        }\n    };\n\n    /**\n     * Add a bezier command\n     */\n    ctx.prototype.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n        this.__currentPosition = {x: x, y: y};\n        this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\",\n            {cp1x:cp1x, cp1y:cp1y, cp2x:cp2x, cp2y:cp2y, x:x, y:y}));\n    };\n\n    /**\n     * Adds a quadratic curve to command\n     */\n    ctx.prototype.quadraticCurveTo = function (cpx, cpy, x, y) {\n        this.__currentPosition = {x: x, y: y};\n        this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {cpx:cpx, cpy:cpy, x:x, y:y}));\n    };\n\n\n    /**\n     * Return a new normalized vector of given vector\n     */\n    var normalize = function (vector) {\n        var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\n        return [vector[0] / len, vector[1] / len];\n    };\n\n    /**\n     * Adds the arcTo to the current path\n     *\n     * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\n     */\n    ctx.prototype.arcTo = function (x1, y1, x2, y2, radius) {\n        // Let the point (x0, y0) be the last point in the subpath.\n        var x0 = this.__currentPosition && this.__currentPosition.x;\n        var y0 = this.__currentPosition && this.__currentPosition.y;\n\n        // First ensure there is a subpath for (x1, y1).\n        if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\n            return;\n        }\n\n        // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\n        if (radius < 0) {\n            throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\n        }\n\n        // If the point (x0, y0) is equal to the point (x1, y1),\n        // or if the point (x1, y1) is equal to the point (x2, y2),\n        // or if the radius radius is zero,\n        // then the method must add the point (x1, y1) to the subpath,\n        // and connect that point to the previous point (x0, y0) by a straight line.\n        if (((x0 === x1) && (y0 === y1))\n            || ((x1 === x2) && (y1 === y2))\n            || (radius === 0)) {\n            this.lineTo(x1, y1);\n            return;\n        }\n\n        // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\n        // then the method must add the point (x1, y1) to the subpath,\n        // and connect that point to the previous point (x0, y0) by a straight line.\n        var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\n        var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\n        if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\n            this.lineTo(x1, y1);\n            return;\n        }\n\n        // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\n        // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\n        // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\n        // The points at which this circle touches these two lines are called the start and end tangent points respectively.\n\n        // note that both vectors are unit vectors, so the length is 1\n        var cos = (unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1]);\n        var theta = Math.acos(Math.abs(cos));\n\n        // Calculate origin\n        var unit_vec_p1_origin = normalize([\n            unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\n            unit_vec_p1_p0[1] + unit_vec_p1_p2[1]\n        ]);\n        var len_p1_origin = radius / Math.sin(theta / 2);\n        var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\n        var y = y1 + len_p1_origin * unit_vec_p1_origin[1];\n\n        // Calculate start angle and end angle\n        // rotate 90deg clockwise (note that y axis points to its down)\n        var unit_vec_origin_start_tangent = [\n            -unit_vec_p1_p0[1],\n            unit_vec_p1_p0[0]\n        ];\n        // rotate 90deg counter clockwise (note that y axis points to its down)\n        var unit_vec_origin_end_tangent = [\n            unit_vec_p1_p2[1],\n            -unit_vec_p1_p2[0]\n        ];\n        var getAngle = function (vector) {\n            // get angle (clockwise) between vector and (1, 0)\n            var x = vector[0];\n            var y = vector[1];\n            if (y >= 0) { // note that y axis points to its down\n                return Math.acos(x);\n            } else {\n                return -Math.acos(x);\n            }\n        };\n        var startAngle = getAngle(unit_vec_origin_start_tangent);\n        var endAngle = getAngle(unit_vec_origin_end_tangent);\n\n        // Connect the point (x0, y0) to the start tangent point by a straight line\n        this.lineTo(x + unit_vec_origin_start_tangent[0] * radius,\n                    y + unit_vec_origin_start_tangent[1] * radius);\n\n        // Connect the start tangent point to the end tangent point by arc\n        // and adding the end tangent point to the subpath.\n        this.arc(x, y, radius, startAngle, endAngle);\n    };\n\n    /**\n     * Sets the stroke property on the current element\n     */\n    ctx.prototype.stroke = function () {\n        if (this.__currentElement.nodeName === \"path\") {\n            this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\n        }\n        this.__applyCurrentDefaultPath();\n        this.__applyStyleToCurrentElement(\"stroke\");\n    };\n\n    /**\n     * Sets fill properties on the current element\n     */\n    ctx.prototype.fill = function () {\n        if (this.__currentElement.nodeName === \"path\") {\n            this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\n        }\n        this.__applyCurrentDefaultPath();\n        this.__applyStyleToCurrentElement(\"fill\");\n    };\n\n    /**\n     *  Adds a rectangle to the path.\n     */\n    ctx.prototype.rect = function (x, y, width, height) {\n        if (this.__currentElement.nodeName !== \"path\") {\n            this.beginPath();\n        }\n        this.moveTo(x, y);\n        this.lineTo(x+width, y);\n        this.lineTo(x+width, y+height);\n        this.lineTo(x, y+height);\n        this.lineTo(x, y);\n        this.closePath();\n    };\n\n\n    /**\n     * adds a rectangle element\n     */\n    ctx.prototype.fillRect = function (x, y, width, height) {\n        var rect, parent;\n        rect = this.__createElement(\"rect\", {\n            x : x,\n            y : y,\n            width : width,\n            height : height\n        }, true);\n        parent = this.__closestGroupOrSvg();\n        parent.appendChild(rect);\n        this.__currentElement = rect;\n        this.__applyStyleToCurrentElement(\"fill\");\n    };\n\n    /**\n     * Draws a rectangle with no fill\n     * @param x\n     * @param y\n     * @param width\n     * @param height\n     */\n    ctx.prototype.strokeRect = function (x, y, width, height) {\n        var rect, parent;\n        rect = this.__createElement(\"rect\", {\n            x : x,\n            y : y,\n            width : width,\n            height : height\n        }, true);\n        parent = this.__closestGroupOrSvg();\n        parent.appendChild(rect);\n        this.__currentElement = rect;\n        this.__applyStyleToCurrentElement(\"stroke\");\n    };\n\n\n    /**\n     * Clear entire canvas:\n     * 1. save current transforms\n     * 2. remove all the childNodes of the root g element\n     */\n    ctx.prototype.__clearCanvas = function () {\n        var current = this.__closestGroupOrSvg(),\n            transform = current.getAttribute(\"transform\");\n        var rootGroup = this.__root.childNodes[1];\n        var childNodes = rootGroup.childNodes;\n        for (var i = childNodes.length - 1; i >= 0; i--) {\n            if (childNodes[i]) {\n                rootGroup.removeChild(childNodes[i]);\n            }\n        }\n        this.__currentElement = rootGroup;\n        //reset __groupStack as all the child group nodes are all removed.\n        this.__groupStack = [];\n        if (transform) {\n            this.__addTransform(transform);\n        }\n    };\n\n    /**\n     * \"Clears\" a canvas by just drawing a white rectangle in the current group.\n     */\n    ctx.prototype.clearRect = function (x, y, width, height) {\n        //clear entire canvas\n        if (x === 0 && y === 0 && width === this.width && height === this.height) {\n            this.__clearCanvas();\n            return;\n        }\n        var rect, parent = this.__closestGroupOrSvg();\n        rect = this.__createElement(\"rect\", {\n            x : x,\n            y : y,\n            width : width,\n            height : height,\n            fill : \"#FFFFFF\"\n        }, true);\n        parent.appendChild(rect);\n    };\n\n    /**\n     * Adds a linear gradient to a defs tag.\n     * Returns a canvas gradient object that has a reference to it's parent def\n     */\n    ctx.prototype.createLinearGradient = function (x1, y1, x2, y2) {\n        var grad = this.__createElement(\"linearGradient\", {\n            id : randomString(this.__ids),\n            x1 : x1+\"px\",\n            x2 : x2+\"px\",\n            y1 : y1+\"px\",\n            y2 : y2+\"px\",\n            \"gradientUnits\" : \"userSpaceOnUse\"\n        }, false);\n        this.__defs.appendChild(grad);\n        return new CanvasGradient(grad, this);\n    };\n\n    /**\n     * Adds a radial gradient to a defs tag.\n     * Returns a canvas gradient object that has a reference to it's parent def\n     */\n    ctx.prototype.createRadialGradient = function (x0, y0, r0, x1, y1, r1) {\n        var grad = this.__createElement(\"radialGradient\", {\n            id : randomString(this.__ids),\n            cx : x1+\"px\",\n            cy : y1+\"px\",\n            r  : r1+\"px\",\n            fx : x0+\"px\",\n            fy : y0+\"px\",\n            \"gradientUnits\" : \"userSpaceOnUse\"\n        }, false);\n        this.__defs.appendChild(grad);\n        return new CanvasGradient(grad, this);\n\n    };\n\n    /**\n     * Parses the font string and returns svg mapping\n     * @private\n     */\n    ctx.prototype.__parseFont = function () {\n        var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\'\\\"\\sa-z0-9]+?)\\s*$/i;\n        var fontPart = regex.exec( this.font );\n        var data = {\n            style : fontPart[1] || 'normal',\n            size : fontPart[4] || '10px',\n            family : fontPart[6] || 'sans-serif',\n            weight: fontPart[3] || 'normal',\n            decoration : fontPart[2] || 'normal',\n            href : null\n        };\n\n        //canvas doesn't support underline natively, but we can pass this attribute\n        if (this.__fontUnderline === \"underline\") {\n            data.decoration = \"underline\";\n        }\n\n        //canvas also doesn't support linking, but we can pass this as well\n        if (this.__fontHref) {\n            data.href = this.__fontHref;\n        }\n\n        return data;\n    };\n\n    /**\n     * Helper to link text fragments\n     * @param font\n     * @param element\n     * @return {*}\n     * @private\n     */\n    ctx.prototype.__wrapTextLink = function (font, element) {\n        if (font.href) {\n            var a = this.__createElement(\"a\");\n            a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\n            a.appendChild(element);\n            return a;\n        }\n        return element;\n    };\n\n    /**\n     * Fills or strokes text\n     * @param text\n     * @param x\n     * @param y\n     * @param action - stroke or fill\n     * @private\n     */\n    ctx.prototype.__applyText = function (text, x, y, action) {\n        var font = this.__parseFont(),\n            parent = this.__closestGroupOrSvg(),\n            textElement = this.__createElement(\"text\", {\n                \"font-family\" : font.family,\n                \"font-size\" : font.size,\n                \"font-style\" : font.style,\n                \"font-weight\" : font.weight,\n                \"text-decoration\" : font.decoration,\n                \"x\" : x,\n                \"y\" : y,\n                \"text-anchor\": getTextAnchor(this.textAlign),\n                \"dominant-baseline\": getDominantBaseline(this.textBaseline)\n            }, true);\n\n        textElement.appendChild(this.__document.createTextNode(text));\n        this.__currentElement = textElement;\n        this.__applyStyleToCurrentElement(action);\n        parent.appendChild(this.__wrapTextLink(font,textElement));\n    };\n\n    /**\n     * Creates a text element\n     * @param text\n     * @param x\n     * @param y\n     */\n    ctx.prototype.fillText = function (text, x, y) {\n        this.__applyText(text, x, y, \"fill\");\n    };\n\n    /**\n     * Strokes text\n     * @param text\n     * @param x\n     * @param y\n     */\n    ctx.prototype.strokeText = function (text, x, y) {\n        this.__applyText(text, x, y, \"stroke\");\n    };\n\n    /**\n     * No need to implement this for svg.\n     * @param text\n     * @return {TextMetrics}\n     */\n    ctx.prototype.measureText = function (text) {\n        this.__ctx.font = this.font;\n        return this.__ctx.measureText(text);\n    };\n\n    /**\n     *  Arc command!\n     */\n    ctx.prototype.arc = function (x, y, radius, startAngle, endAngle, counterClockwise) {\n        // in canvas no circle is drawn if no angle is provided.\n        if (startAngle === endAngle) {\n            return;\n        }\n        startAngle = startAngle % (2*Math.PI);\n        endAngle = endAngle % (2*Math.PI);\n        if (startAngle === endAngle) {\n            //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\n            endAngle = ((endAngle + (2*Math.PI)) - 0.001 * (counterClockwise ? -1 : 1)) % (2*Math.PI);\n        }\n        var endX = x+radius*Math.cos(endAngle),\n            endY = y+radius*Math.sin(endAngle),\n            startX = x+radius*Math.cos(startAngle),\n            startY = y+radius*Math.sin(startAngle),\n            sweepFlag = counterClockwise ? 0 : 1,\n            largeArcFlag = 0,\n            diff = endAngle - startAngle;\n\n        // https://github.com/gliffy/canvas2svg/issues/4\n        if (diff < 0) {\n            diff += 2*Math.PI;\n        }\n\n        if (counterClockwise) {\n            largeArcFlag = diff > Math.PI ? 0 : 1;\n        } else {\n            largeArcFlag = diff > Math.PI ? 1 : 0;\n        }\n\n        this.lineTo(startX, startY);\n        this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\n            {rx:radius, ry:radius, xAxisRotation:0, largeArcFlag:largeArcFlag, sweepFlag:sweepFlag, endX:endX, endY:endY}));\n\n        this.__currentPosition = {x: endX, y: endY};\n    };\n\n    /**\n     * Generates a ClipPath from the clip command.\n     */\n    ctx.prototype.clip = function () {\n        var group = this.__closestGroupOrSvg(),\n            clipPath = this.__createElement(\"clipPath\"),\n            id =  randomString(this.__ids),\n            newGroup = this.__createElement(\"g\");\n\n        this.__applyCurrentDefaultPath();\n        group.removeChild(this.__currentElement);\n        clipPath.setAttribute(\"id\", id);\n        clipPath.appendChild(this.__currentElement);\n\n        this.__defs.appendChild(clipPath);\n\n        //set the clip path to this group\n        group.setAttribute(\"clip-path\", format(\"url(#{id})\", {id:id}));\n\n        //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\n        // to this path\n        group.appendChild(newGroup);\n\n        this.__currentElement = newGroup;\n\n    };\n\n    /**\n     * Draws a canvas, image or mock context to this canvas.\n     * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\n     * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\n     */\n    ctx.prototype.drawImage = function () {\n        //convert arguments to a real array\n        var args = Array.prototype.slice.call(arguments),\n            image=args[0],\n            dx, dy, dw, dh, sx=0, sy=0, sw, sh, parent, svg, defs, group,\n            currentElement, svgImage, canvas, context, id;\n\n        if (args.length === 3) {\n            dx = args[1];\n            dy = args[2];\n            sw = image.width;\n            sh = image.height;\n            dw = sw;\n            dh = sh;\n        } else if (args.length === 5) {\n            dx = args[1];\n            dy = args[2];\n            dw = args[3];\n            dh = args[4];\n            sw = image.width;\n            sh = image.height;\n        } else if (args.length === 9) {\n            sx = args[1];\n            sy = args[2];\n            sw = args[3];\n            sh = args[4];\n            dx = args[5];\n            dy = args[6];\n            dw = args[7];\n            dh = args[8];\n        } else {\n            throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\n        }\n\n        parent = this.__closestGroupOrSvg();\n        currentElement = this.__currentElement;\n        var translateDirective = \"translate(\" + dx + \", \" + dy + \")\";\n        if (image instanceof ctx) {\n            //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\n            //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\n            svg = image.getSvg().cloneNode(true);\n            if (svg.childNodes && svg.childNodes.length > 1) {\n                defs = svg.childNodes[0];\n                while(defs.childNodes.length) {\n                    id = defs.childNodes[0].getAttribute(\"id\");\n                    this.__ids[id] = id;\n                    this.__defs.appendChild(defs.childNodes[0]);\n                }\n                group = svg.childNodes[1];\n                if (group) {\n                    //save original transform\n                    var originTransform = group.getAttribute(\"transform\");\n                    var transformDirective;\n                    if (originTransform) {\n                        transformDirective = originTransform+\" \"+translateDirective;\n                    } else {\n                        transformDirective = translateDirective;\n                    }\n                    group.setAttribute(\"transform\", transformDirective);\n                    parent.appendChild(group);\n                }\n            }\n        } else if (image.nodeName === \"IMG\") {\n            svgImage = this.__createElement(\"image\");\n            svgImage.setAttribute(\"width\", dw);\n            svgImage.setAttribute(\"height\", dh);\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\n\n            if (sx || sy || sw !== image.width || sh !== image.height) {\n                //crop the image using a temporary canvas\n                canvas = this.__document.createElement(\"canvas\");\n                canvas.width = dw;\n                canvas.height = dh;\n                context = canvas.getContext(\"2d\");\n                context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\n                image = canvas;\n            }\n            svgImage.setAttribute(\"transform\", translateDirective);\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\n            parent.appendChild(svgImage);\n        } else if (image.nodeName === \"CANVAS\") {\n            svgImage = this.__createElement(\"image\");\n            svgImage.setAttribute(\"width\", dw);\n            svgImage.setAttribute(\"height\", dh);\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\n\n            // draw canvas onto temporary canvas so that smoothing can be handled\n            canvas = this.__document.createElement(\"canvas\");\n            canvas.width = dw;\n            canvas.height = dh;\n            context = canvas.getContext(\"2d\");\n            context.imageSmoothingEnabled = false;\n            context.mozImageSmoothingEnabled = false;\n            context.oImageSmoothingEnabled = false;\n            context.webkitImageSmoothingEnabled = false;\n            context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\n            image = canvas;\n\n            svgImage.setAttribute(\"transform\", translateDirective);\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", image.toDataURL());\n            parent.appendChild(svgImage);\n        }\n    };\n\n    /**\n     * Generates a pattern tag\n     */\n    ctx.prototype.createPattern = function (image, repetition) {\n        var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"), id = randomString(this.__ids),\n            img;\n        pattern.setAttribute(\"id\", id);\n        pattern.setAttribute(\"width\", image.width);\n        pattern.setAttribute(\"height\", image.height);\n        if (image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\n            img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n            img.setAttribute(\"width\", image.width);\n            img.setAttribute(\"height\", image.height);\n            img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\n            pattern.appendChild(img);\n            this.__defs.appendChild(pattern);\n        } else if (image instanceof ctx) {\n            pattern.appendChild(image.__root.childNodes[1]);\n            this.__defs.appendChild(pattern);\n        }\n        return new CanvasPattern(pattern, this);\n    };\n\n    ctx.prototype.setLineDash = function (dashArray) {\n        if (dashArray && dashArray.length > 0) {\n            this.lineDash = dashArray.join(\",\");\n        } else {\n            this.lineDash = null;\n        }\n    };\n\n    /**\n     * Not yet implemented\n     */\n    ctx.prototype.drawFocusRing = function () {};\n    ctx.prototype.createImageData = function () {};\n    ctx.prototype.getImageData = function () {};\n    ctx.prototype.putImageData = function () {};\n    ctx.prototype.globalCompositeOperation = function () {};\n    ctx.prototype.setTransform = function () {};\n\n    export default ctx;\n"]},"metadata":{},"sourceType":"module"}