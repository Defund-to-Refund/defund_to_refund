{"ast":null,"code":"\"use strict\";\n\nvar $ = require(\"../slick.jquery\");\n\nvar Slick = require(\"../slick.core\");\n\nvar keyCodes = Slick.keyCode;\n\nfunction CellExternalCopyManager(options) {\n  /*\n    This manager enables users to copy/paste data from/to an external Spreadsheet application\n    such as MS-Excel® or OpenOffice-Spreadsheet.\n     Since it is not possible to access directly the clipboard in javascript, the plugin uses\n    a trick to do it's job. After detecting the keystroke, we dynamically create a textarea\n    where the browser copies/pastes the serialized data.\n     options:\n      copiedCellStyle : sets the css className used for copied cells. default : \"copied\"\n      copiedCellStyleLayerKey : sets the layer key for setting css values of copied cells. default : \"copy-manager\"\n      dataItemColumnValueExtractor : option to specify a custom column value extractor function\n      dataItemColumnValueSetter : option to specify a custom column value setter function\n      clipboardCommandHandler : option to specify a custom handler for paste actions\n      includeHeaderWhenCopying : set to true and the plugin will take the name property from each column (which is usually what appears in your header) and put that as the first row of the text that's copied to the clipboard\n      bodyElement: option to specify a custom DOM element which to will be added the hidden textbox. It's useful if the grid is inside a modal dialog.\n      onCopyInit: optional handler to run when copy action initializes\n      onCopySuccess: optional handler to run when copy action is complete\n      newRowCreator: function to add rows to table if paste overflows bottom of table, if this function is not provided new rows will be ignored.\n      readOnlyMode: suppresses paste\n      headerColumnValueExtractor : option to specify a custom column header value extractor function\n  */\n  var _grid;\n\n  var _self = this;\n\n  var _copiedRanges;\n\n  var _options = options || {};\n\n  var _copiedCellStyleLayerKey = _options.copiedCellStyleLayerKey || \"copy-manager\";\n\n  var _copiedCellStyle = _options.copiedCellStyle || \"copied\";\n\n  var _clearCopyTI = 0;\n\n  var _bodyElement = _options.bodyElement || document.body;\n\n  var _onCopyInit = _options.onCopyInit || null;\n\n  var _onCopySuccess = _options.onCopySuccess || null;\n\n  function init(grid) {\n    _grid = grid;\n\n    _grid.onKeyDown.subscribe(handleKeyDown); // we need a cell selection model\n\n\n    var cellSelectionModel = grid.getSelectionModel();\n\n    if (!cellSelectionModel) {\n      throw new Error(\"Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())\");\n    } // we give focus on the grid when a selection is done on it.\n    // without this, if the user selects a range of cell without giving focus on a particular cell, the grid doesn't get the focus and key stroke handles (ctrl+c) don't work\n\n\n    cellSelectionModel.onSelectedRangesChanged.subscribe(function (e, args) {\n      _grid.focus();\n    });\n  }\n\n  function destroy() {\n    _grid.onKeyDown.unsubscribe(handleKeyDown);\n  }\n\n  function getHeaderValueForColumn(columnDef) {\n    if (_options.headerColumnValueExtractor) {\n      var val = _options.headerColumnValueExtractor(columnDef);\n\n      if (val) {\n        return val;\n      }\n    }\n\n    return columnDef.name;\n  }\n\n  function getDataItemValueForColumn(item, columnDef, e) {\n    if (_options.dataItemColumnValueExtractor) {\n      var val = _options.dataItemColumnValueExtractor(item, columnDef);\n\n      if (val) {\n        return val;\n      }\n    }\n\n    var retVal = ''; // if a custom getter is not defined, we call serializeValue of the editor to serialize\n\n    if (columnDef.editor) {\n      var editorArgs = {\n        'container': $(\"<p>\"),\n        // a dummy container\n        'column': columnDef,\n        'position': {\n          'top': 0,\n          'left': 0\n        },\n        // a dummy position required by some editors\n        'grid': _grid,\n        'event': e\n      };\n      var editor = new columnDef.editor(editorArgs);\n      editor.loadValue(item);\n      retVal = editor.serializeValue();\n      editor.destroy();\n    } else {\n      retVal = item[columnDef.field];\n    }\n\n    return retVal;\n  }\n\n  function setDataItemValueForColumn(item, columnDef, value) {\n    if (_options.dataItemColumnValueSetter) {\n      return _options.dataItemColumnValueSetter(item, columnDef, value);\n    } // if a custom setter is not defined, we call applyValue of the editor to unserialize\n\n\n    if (columnDef.editor) {\n      var editorArgs = {\n        'container': $(\"body\"),\n        // a dummy container\n        'column': columnDef,\n        'position': {\n          'top': 0,\n          'left': 0\n        },\n        // a dummy position required by some editors\n        'grid': _grid\n      };\n      var editor = new columnDef.editor(editorArgs);\n      editor.loadValue(item);\n      editor.applyValue(item, value);\n      editor.destroy();\n    } else {\n      item[columnDef.field] = value;\n    }\n  }\n\n  function _createTextBox(innerText) {\n    var ta = document.createElement('textarea');\n    ta.style.position = 'absolute';\n    ta.style.left = '-1000px';\n    ta.style.top = document.body.scrollTop + 'px';\n    ta.value = innerText;\n\n    _bodyElement.appendChild(ta);\n\n    ta.select();\n    return ta;\n  }\n\n  function _decodeTabularData(_grid, ta) {\n    var columns = _grid.getColumns();\n\n    var clipText = ta.value;\n    var clipRows = clipText.split(/[\\n\\f\\r]/); // trim trailing CR if present\n\n    if (clipRows[clipRows.length - 1] == \"\") {\n      clipRows.pop();\n    }\n\n    var clippedRange = [];\n    var j = 0;\n\n    _bodyElement.removeChild(ta);\n\n    for (var i = 0; i < clipRows.length; i++) {\n      if (clipRows[i] != \"\") clippedRange[j++] = clipRows[i].split(\"\\t\");else clippedRange[i] = [\"\"];\n    }\n\n    var selectedCell = _grid.getActiveCell();\n\n    var ranges = _grid.getSelectionModel().getSelectedRanges();\n\n    var selectedRange = ranges && ranges.length ? ranges[0] : null; // pick only one selection\n\n    var activeRow = null;\n    var activeCell = null;\n\n    if (selectedRange) {\n      activeRow = selectedRange.fromRow;\n      activeCell = selectedRange.fromCell;\n    } else if (selectedCell) {\n      activeRow = selectedCell.row;\n      activeCell = selectedCell.cell;\n    } else {\n      // we don't know where to paste\n      return;\n    }\n\n    var oneCellToMultiple = false;\n    var destH = clippedRange.length;\n    var destW = clippedRange.length ? clippedRange[0].length : 0;\n\n    if (clippedRange.length == 1 && clippedRange[0].length == 1 && selectedRange) {\n      oneCellToMultiple = true;\n      destH = selectedRange.toRow - selectedRange.fromRow + 1;\n      destW = selectedRange.toCell - selectedRange.fromCell + 1;\n    }\n\n    var availableRows = _grid.getData().length - activeRow;\n    var addRows = 0; // ignore new rows if we don't have a \"newRowCreator\"\n\n    if (availableRows < destH && _options.newRowCreator) {\n      var d = _grid.getData();\n\n      for (addRows = 1; addRows <= destH - availableRows; addRows++) d.push({});\n\n      _grid.setData(d);\n\n      _grid.render();\n    }\n\n    var overflowsBottomOfGrid = activeRow + destH > _grid.getDataLength();\n\n    if (_options.newRowCreator && overflowsBottomOfGrid) {\n      var newRowsNeeded = activeRow + destH - _grid.getDataLength();\n\n      _options.newRowCreator(newRowsNeeded);\n    }\n\n    var clipCommand = {\n      isClipboardCommand: true,\n      clippedRange: clippedRange,\n      oldValues: [],\n      cellExternalCopyManager: _self,\n      _options: _options,\n      setDataItemValueForColumn: setDataItemValueForColumn,\n      markCopySelection: markCopySelection,\n      oneCellToMultiple: oneCellToMultiple,\n      activeRow: activeRow,\n      activeCell: activeCell,\n      destH: destH,\n      destW: destW,\n      maxDestY: _grid.getDataLength(),\n      maxDestX: _grid.getColumns().length,\n      h: 0,\n      w: 0,\n      execute: function () {\n        this.h = 0;\n\n        for (var y = 0; y < this.destH; y++) {\n          this.oldValues[y] = [];\n          this.w = 0;\n          this.h++;\n\n          for (var x = 0; x < this.destW; x++) {\n            this.w++;\n            var desty = activeRow + y;\n            var destx = activeCell + x;\n\n            if (desty < this.maxDestY && destx < this.maxDestX) {\n              var nd = _grid.getCellNode(desty, destx);\n\n              var dt = _grid.getDataItem(desty);\n\n              this.oldValues[y][x] = dt[columns[destx]['field']];\n              if (oneCellToMultiple) this.setDataItemValueForColumn(dt, columns[destx], clippedRange[0][0]);else this.setDataItemValueForColumn(dt, columns[destx], clippedRange[y] ? clippedRange[y][x] : '');\n\n              _grid.updateCell(desty, destx);\n\n              _grid.onCellChange.notify({\n                row: desty,\n                cell: destx,\n                item: dt,\n                grid: _grid\n              });\n            }\n          }\n        }\n\n        var bRange = {\n          'fromCell': activeCell,\n          'fromRow': activeRow,\n          'toCell': activeCell + this.w - 1,\n          'toRow': activeRow + this.h - 1\n        };\n        this.markCopySelection([bRange]);\n\n        _grid.getSelectionModel().setSelectedRanges([bRange]);\n\n        this.cellExternalCopyManager.onPasteCells.notify({\n          ranges: [bRange]\n        });\n      },\n      undo: function () {\n        for (var y = 0; y < this.destH; y++) {\n          for (var x = 0; x < this.destW; x++) {\n            var desty = activeRow + y;\n            var destx = activeCell + x;\n\n            if (desty < this.maxDestY && destx < this.maxDestX) {\n              var nd = _grid.getCellNode(desty, destx);\n\n              var dt = _grid.getDataItem(desty);\n\n              if (oneCellToMultiple) this.setDataItemValueForColumn(dt, columns[destx], this.oldValues[0][0]);else this.setDataItemValueForColumn(dt, columns[destx], this.oldValues[y][x]);\n\n              _grid.updateCell(desty, destx);\n\n              _grid.onCellChange.notify({\n                row: desty,\n                cell: destx,\n                item: dt,\n                grid: _grid\n              });\n            }\n          }\n        }\n\n        var bRange = {\n          'fromCell': activeCell,\n          'fromRow': activeRow,\n          'toCell': activeCell + this.w - 1,\n          'toRow': activeRow + this.h - 1\n        };\n        this.markCopySelection([bRange]);\n\n        _grid.getSelectionModel().setSelectedRanges([bRange]);\n\n        this.cellExternalCopyManager.onPasteCells.notify({\n          ranges: [bRange]\n        });\n\n        if (addRows > 1) {\n          var d = _grid.getData();\n\n          for (; addRows > 1; addRows--) d.splice(d.length - 1, 1);\n\n          _grid.setData(d);\n\n          _grid.render();\n        }\n      }\n    };\n\n    if (_options.clipboardCommandHandler) {\n      _options.clipboardCommandHandler(clipCommand);\n    } else {\n      clipCommand.execute();\n    }\n  }\n\n  function handleKeyDown(e, args) {\n    var ranges;\n\n    if (!_grid.getEditorLock().isActive() || _grid.getOptions().autoEdit) {\n      if (e.which == keyCodes.ESC) {\n        if (_copiedRanges) {\n          e.preventDefault();\n          clearCopySelection();\n\n          _self.onCopyCancelled.notify({\n            ranges: _copiedRanges\n          });\n\n          _copiedRanges = null;\n        }\n      }\n\n      if ((e.which === keyCodes.C || e.which === keyCodes.INSERT) && (e.ctrlKey || e.metaKey) && !e.shiftKey) {\n        // CTRL+C or CTRL+INS\n        if (_onCopyInit) {\n          _onCopyInit.call();\n        }\n\n        ranges = _grid.getSelectionModel().getSelectedRanges();\n\n        if (ranges.length != 0) {\n          _copiedRanges = ranges;\n          markCopySelection(ranges);\n\n          _self.onCopyCells.notify({\n            ranges: ranges\n          });\n\n          var columns = _grid.getColumns();\n\n          var clipText = \"\";\n\n          for (var rg = 0; rg < ranges.length; rg++) {\n            var range = ranges[rg];\n            var clipTextRows = [];\n\n            for (var i = range.fromRow; i < range.toRow + 1; i++) {\n              var clipTextCells = [];\n\n              var dt = _grid.getDataItem(i);\n\n              if (clipTextRows == \"\" && _options.includeHeaderWhenCopying) {\n                var clipTextHeaders = [];\n\n                for (var j = range.fromCell; j < range.toCell + 1; j++) {\n                  if (columns[j].name.length > 0) clipTextHeaders.push(getHeaderValueForColumn(columns[j]));\n                }\n\n                clipTextRows.push(clipTextHeaders.join(\"\\t\"));\n              }\n\n              for (var j = range.fromCell; j < range.toCell + 1; j++) {\n                clipTextCells.push(getDataItemValueForColumn(dt, columns[j], e));\n              }\n\n              clipTextRows.push(clipTextCells.join(\"\\t\"));\n            }\n\n            clipText += clipTextRows.join(\"\\r\\n\") + \"\\r\\n\";\n          }\n\n          if (window.clipboardData) {\n            window.clipboardData.setData(\"Text\", clipText);\n            return true;\n          } else {\n            var focusEl = document.activeElement;\n\n            var ta = _createTextBox(clipText);\n\n            ta.focus();\n            setTimeout(function () {\n              _bodyElement.removeChild(ta); // restore focus\n\n\n              if (focusEl) focusEl.focus();else console.log(\"Not element to restore focus to after copy?\");\n            }, 100);\n\n            if (_onCopySuccess) {\n              var rowCount = 0; // If it's cell selection, use the toRow/fromRow fields\n\n              if (ranges.length === 1) {\n                rowCount = ranges[0].toRow + 1 - ranges[0].fromRow;\n              } else {\n                rowCount = ranges.length;\n              }\n\n              _onCopySuccess.call(this, rowCount);\n            }\n\n            return false;\n          }\n        }\n      }\n\n      if (!_options.readOnlyMode && (e.which === keyCodes.V && (e.ctrlKey || e.metaKey) && !e.shiftKey || e.which === keyCodes.INSERT && e.shiftKey && !e.ctrlKey)) {\n        // CTRL+V or Shift+INS\n        var ta = _createTextBox('');\n\n        setTimeout(function () {\n          _decodeTabularData(_grid, ta);\n        }, 100);\n        return false;\n      }\n    }\n  }\n\n  function markCopySelection(ranges) {\n    clearCopySelection();\n\n    var columns = _grid.getColumns();\n\n    var hash = {};\n\n    for (var i = 0; i < ranges.length; i++) {\n      for (var j = ranges[i].fromRow; j <= ranges[i].toRow; j++) {\n        hash[j] = {};\n\n        for (var k = ranges[i].fromCell; k <= ranges[i].toCell && k < columns.length; k++) {\n          hash[j][columns[k].id] = _copiedCellStyle;\n        }\n      }\n    }\n\n    _grid.setCellCssStyles(_copiedCellStyleLayerKey, hash);\n\n    clearTimeout(_clearCopyTI);\n    _clearCopyTI = setTimeout(function () {\n      _self.clearCopySelection();\n    }, 2000);\n  }\n\n  function clearCopySelection() {\n    _grid.removeCellCssStyles(_copiedCellStyleLayerKey);\n  }\n\n  function setIncludeHeaderWhenCopying(includeHeaderWhenCopying) {\n    _options.includeHeaderWhenCopying = includeHeaderWhenCopying;\n  }\n\n  $.extend(this, {\n    \"init\": init,\n    \"destroy\": destroy,\n    \"clearCopySelection\": clearCopySelection,\n    \"handleKeyDown\": handleKeyDown,\n    \"onCopyCells\": new Slick.Event(),\n    \"onCopyCancelled\": new Slick.Event(),\n    \"onPasteCells\": new Slick.Event(),\n    \"setIncludeHeaderWhenCopying\": setIncludeHeaderWhenCopying\n  });\n}\n\nmodule.exports = {\n  \"CellExternalCopyManager\": CellExternalCopyManager\n};","map":{"version":3,"sources":["/Users/gen/Desktop/defund_to_refund/node_modules/@bokeh/slickgrid/plugins/slick.cellexternalcopymanager.js"],"names":["$","require","Slick","keyCodes","keyCode","CellExternalCopyManager","options","_grid","_self","_copiedRanges","_options","_copiedCellStyleLayerKey","copiedCellStyleLayerKey","_copiedCellStyle","copiedCellStyle","_clearCopyTI","_bodyElement","bodyElement","document","body","_onCopyInit","onCopyInit","_onCopySuccess","onCopySuccess","init","grid","onKeyDown","subscribe","handleKeyDown","cellSelectionModel","getSelectionModel","Error","onSelectedRangesChanged","e","args","focus","destroy","unsubscribe","getHeaderValueForColumn","columnDef","headerColumnValueExtractor","val","name","getDataItemValueForColumn","item","dataItemColumnValueExtractor","retVal","editor","editorArgs","loadValue","serializeValue","field","setDataItemValueForColumn","value","dataItemColumnValueSetter","applyValue","_createTextBox","innerText","ta","createElement","style","position","left","top","scrollTop","appendChild","select","_decodeTabularData","columns","getColumns","clipText","clipRows","split","length","pop","clippedRange","j","removeChild","i","selectedCell","getActiveCell","ranges","getSelectedRanges","selectedRange","activeRow","activeCell","fromRow","fromCell","row","cell","oneCellToMultiple","destH","destW","toRow","toCell","availableRows","getData","addRows","newRowCreator","d","push","setData","render","overflowsBottomOfGrid","getDataLength","newRowsNeeded","clipCommand","isClipboardCommand","oldValues","cellExternalCopyManager","markCopySelection","maxDestY","maxDestX","h","w","execute","y","x","desty","destx","nd","getCellNode","dt","getDataItem","updateCell","onCellChange","notify","bRange","setSelectedRanges","onPasteCells","undo","splice","clipboardCommandHandler","getEditorLock","isActive","getOptions","autoEdit","which","ESC","preventDefault","clearCopySelection","onCopyCancelled","C","INSERT","ctrlKey","metaKey","shiftKey","call","onCopyCells","rg","range","clipTextRows","clipTextCells","includeHeaderWhenCopying","clipTextHeaders","join","window","clipboardData","focusEl","activeElement","setTimeout","console","log","rowCount","readOnlyMode","V","hash","k","id","setCellCssStyles","clearTimeout","removeCellCssStyles","setIncludeHeaderWhenCopying","extend","Event","module","exports"],"mappings":"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","sourcesContent":["  \"use strict\";\n  var $ = require(\"../slick.jquery\");\n  var Slick = require(\"../slick.core\");\n  var keyCodes = Slick.keyCode;\n\n  function CellExternalCopyManager(options) {\n    /*\n      This manager enables users to copy/paste data from/to an external Spreadsheet application\n      such as MS-Excel® or OpenOffice-Spreadsheet.\n\n      Since it is not possible to access directly the clipboard in javascript, the plugin uses\n      a trick to do it's job. After detecting the keystroke, we dynamically create a textarea\n      where the browser copies/pastes the serialized data.\n\n      options:\n        copiedCellStyle : sets the css className used for copied cells. default : \"copied\"\n        copiedCellStyleLayerKey : sets the layer key for setting css values of copied cells. default : \"copy-manager\"\n        dataItemColumnValueExtractor : option to specify a custom column value extractor function\n        dataItemColumnValueSetter : option to specify a custom column value setter function\n        clipboardCommandHandler : option to specify a custom handler for paste actions\n        includeHeaderWhenCopying : set to true and the plugin will take the name property from each column (which is usually what appears in your header) and put that as the first row of the text that's copied to the clipboard\n        bodyElement: option to specify a custom DOM element which to will be added the hidden textbox. It's useful if the grid is inside a modal dialog.\n        onCopyInit: optional handler to run when copy action initializes\n        onCopySuccess: optional handler to run when copy action is complete\n        newRowCreator: function to add rows to table if paste overflows bottom of table, if this function is not provided new rows will be ignored.\n        readOnlyMode: suppresses paste\n        headerColumnValueExtractor : option to specify a custom column header value extractor function\n    */\n    var _grid;\n    var _self = this;\n    var _copiedRanges;\n    var _options = options || {};\n    var _copiedCellStyleLayerKey = _options.copiedCellStyleLayerKey || \"copy-manager\";\n    var _copiedCellStyle = _options.copiedCellStyle || \"copied\";\n    var _clearCopyTI = 0;\n    var _bodyElement = _options.bodyElement || document.body;\n    var _onCopyInit = _options.onCopyInit || null;\n    var _onCopySuccess = _options.onCopySuccess || null;\n\n    function init(grid) {\n      _grid = grid;\n      _grid.onKeyDown.subscribe(handleKeyDown);\n\n      // we need a cell selection model\n      var cellSelectionModel = grid.getSelectionModel();\n      if (!cellSelectionModel){\n        throw new Error(\"Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())\");\n      }\n      // we give focus on the grid when a selection is done on it.\n      // without this, if the user selects a range of cell without giving focus on a particular cell, the grid doesn't get the focus and key stroke handles (ctrl+c) don't work\n      cellSelectionModel.onSelectedRangesChanged.subscribe(function(e, args){\n        _grid.focus();\n      });\n    }\n\n    function destroy() {\n      _grid.onKeyDown.unsubscribe(handleKeyDown);\n    }\n    \n    function getHeaderValueForColumn(columnDef) {\n      if (_options.headerColumnValueExtractor) {\n        var val = _options.headerColumnValueExtractor(columnDef);\n\n        if (val) { return val; }\n      }\n      \n      return columnDef.name;\n    }\n\n    function getDataItemValueForColumn(item, columnDef, e) {\n      if (_options.dataItemColumnValueExtractor) {\n        var val = _options.dataItemColumnValueExtractor(item, columnDef);\n\n        if (val) { return val; }\n      }\n\n      var retVal = '';\n\n      // if a custom getter is not defined, we call serializeValue of the editor to serialize\n      if (columnDef.editor){\n        var editorArgs = {\n          'container':$(\"<p>\"),  // a dummy container\n          'column':columnDef,\n          'position':{'top':0, 'left':0},  // a dummy position required by some editors\n          'grid':_grid,\n          'event':e\n        };\n        var editor = new columnDef.editor(editorArgs);\n        editor.loadValue(item);\n        retVal = editor.serializeValue();\n        editor.destroy();\n      } else {\n        retVal = item[columnDef.field];\n      }\n\n      return retVal;\n    }\n\n    function setDataItemValueForColumn(item, columnDef, value) {\n      if (_options.dataItemColumnValueSetter) {\n        return _options.dataItemColumnValueSetter(item, columnDef, value);\n      }\n\n      // if a custom setter is not defined, we call applyValue of the editor to unserialize\n      if (columnDef.editor){\n        var editorArgs = {\n          'container':$(\"body\"),  // a dummy container\n          'column':columnDef,\n          'position':{'top':0, 'left':0},  // a dummy position required by some editors\n          'grid':_grid\n        };\n        var editor = new columnDef.editor(editorArgs);\n        editor.loadValue(item);\n        editor.applyValue(item, value);\n        editor.destroy();\n      } else {\n        item[columnDef.field] = value;\n      }\n    }\n\n\n    function _createTextBox(innerText){\n      var ta = document.createElement('textarea');\n      ta.style.position = 'absolute';\n      ta.style.left = '-1000px';\n      ta.style.top = document.body.scrollTop + 'px';\n      ta.value = innerText;\n      _bodyElement.appendChild(ta);\n      ta.select();\n\n      return ta;\n    }\n\n    function _decodeTabularData(_grid, ta){\n      var columns = _grid.getColumns();\n      var clipText = ta.value;\n      var clipRows = clipText.split(/[\\n\\f\\r]/);\n      // trim trailing CR if present\n      if (clipRows[clipRows.length - 1]==\"\") { clipRows.pop(); }\n\n      var clippedRange = [];\n      var j = 0;\n\n      _bodyElement.removeChild(ta);\n      for (var i=0; i<clipRows.length; i++) {\n        if (clipRows[i]!=\"\")\n          clippedRange[j++] = clipRows[i].split(\"\\t\");\n          else\n          clippedRange[i] = [\"\"];\n      }\n      var selectedCell = _grid.getActiveCell();\n      var ranges = _grid.getSelectionModel().getSelectedRanges();\n      var selectedRange = ranges && ranges.length ? ranges[0] : null;   // pick only one selection\n      var activeRow = null;\n      var activeCell = null;\n\n      if (selectedRange){\n        activeRow = selectedRange.fromRow;\n        activeCell = selectedRange.fromCell;\n      } else if (selectedCell){\n        activeRow = selectedCell.row;\n        activeCell = selectedCell.cell;\n      } else {\n        // we don't know where to paste\n        return;\n      }\n\n      var oneCellToMultiple = false;\n      var destH = clippedRange.length;\n      var destW = clippedRange.length ? clippedRange[0].length : 0;\n      if (clippedRange.length == 1 && clippedRange[0].length == 1 && selectedRange){\n        oneCellToMultiple = true;\n        destH = selectedRange.toRow - selectedRange.fromRow +1;\n        destW = selectedRange.toCell - selectedRange.fromCell +1;\n      }\n      var availableRows = _grid.getData().length - activeRow;\n      var addRows = 0;\n\n      // ignore new rows if we don't have a \"newRowCreator\"\n      if(availableRows < destH && _options.newRowCreator)\n      {\n        var d = _grid.getData();\n        for(addRows = 1; addRows <= destH - availableRows; addRows++)\n          d.push({});\n        _grid.setData(d);\n        _grid.render();\n      }\n\n      var overflowsBottomOfGrid = activeRow + destH > _grid.getDataLength();\n\n      if (_options.newRowCreator && overflowsBottomOfGrid) {\n\n        var newRowsNeeded = activeRow + destH - _grid.getDataLength();\n\n        _options.newRowCreator(newRowsNeeded);\n\n      }\n\n      var clipCommand = {\n\n        isClipboardCommand: true,\n        clippedRange: clippedRange,\n        oldValues: [],\n        cellExternalCopyManager: _self,\n        _options: _options,\n        setDataItemValueForColumn: setDataItemValueForColumn,\n        markCopySelection: markCopySelection,\n        oneCellToMultiple: oneCellToMultiple,\n        activeRow: activeRow,\n        activeCell: activeCell,\n        destH: destH,\n        destW: destW,\n        maxDestY: _grid.getDataLength(),\n        maxDestX: _grid.getColumns().length,\n        h: 0,\n        w: 0,\n\n        execute: function() {\n          this.h=0;\n          for (var y = 0; y < this.destH; y++){\n            this.oldValues[y] = [];\n            this.w=0;\n            this.h++;\n            for (var x = 0; x < this.destW; x++){\n              this.w++;\n              var desty = activeRow + y;\n              var destx = activeCell + x;\n\n              if (desty < this.maxDestY && destx < this.maxDestX ) {\n                var nd = _grid.getCellNode(desty, destx);\n                var dt = _grid.getDataItem(desty);\n                this.oldValues[y][x] = dt[columns[destx]['field']];\n                if (oneCellToMultiple)\n                  this.setDataItemValueForColumn(dt, columns[destx], clippedRange[0][0]);\n                else\n                  this.setDataItemValueForColumn(dt, columns[destx], clippedRange[y] ? clippedRange[y][x] : '');\n                _grid.updateCell(desty, destx);\n                _grid.onCellChange.notify({\n                    row: desty,\n                    cell: destx,\n                    item: dt,\n                    grid: _grid\n                });\n\n              }\n            }\n          }\n\n          var bRange = {\n            'fromCell': activeCell,\n            'fromRow': activeRow,\n            'toCell': activeCell+this.w-1,\n            'toRow': activeRow+this.h-1\n          }\n\n          this.markCopySelection([bRange]);\n          _grid.getSelectionModel().setSelectedRanges([bRange]);\n          this.cellExternalCopyManager.onPasteCells.notify({ranges: [bRange]});\n        },\n\n        undo: function() {\n          for (var y = 0; y < this.destH; y++){\n            for (var x = 0; x < this.destW; x++){\n              var desty = activeRow + y;\n              var destx = activeCell + x;\n\n              if (desty < this.maxDestY && destx < this.maxDestX ) {\n                var nd = _grid.getCellNode(desty, destx);\n                var dt = _grid.getDataItem(desty);\n                if (oneCellToMultiple)\n                  this.setDataItemValueForColumn(dt, columns[destx], this.oldValues[0][0]);\n                else\n                  this.setDataItemValueForColumn(dt, columns[destx], this.oldValues[y][x]);\n                _grid.updateCell(desty, destx);\n                _grid.onCellChange.notify({\n                    row: desty,\n                    cell: destx,\n                    item: dt,\n                    grid: _grid\n                });\n              }\n            }\n          }\n\n          var bRange = {\n            'fromCell': activeCell,\n            'fromRow': activeRow,\n            'toCell': activeCell+this.w-1,\n            'toRow': activeRow+this.h-1\n          }\n\n          this.markCopySelection([bRange]);\n          _grid.getSelectionModel().setSelectedRanges([bRange]);\n          this.cellExternalCopyManager.onPasteCells.notify({ranges: [bRange]});\n\n          if(addRows > 1){\n            var d = _grid.getData();\n            for(; addRows > 1; addRows--)\n              d.splice(d.length - 1, 1);\n            _grid.setData(d);\n            _grid.render();\n          }\n        }\n      };\n\n      if(_options.clipboardCommandHandler) {\n        _options.clipboardCommandHandler(clipCommand);\n      }\n      else {\n        clipCommand.execute();\n      }\n    }\n\n\n    function handleKeyDown(e, args) {\n      var ranges;\n      if (!_grid.getEditorLock().isActive() || _grid.getOptions().autoEdit) {\n        if (e.which == keyCodes.ESC) {\n          if (_copiedRanges) {\n            e.preventDefault();\n            clearCopySelection();\n            _self.onCopyCancelled.notify({ranges: _copiedRanges});\n            _copiedRanges = null;\n          }\n        }\n\n        if ((e.which === keyCodes.C || e.which === keyCodes.INSERT) && (e.ctrlKey || e.metaKey) && !e.shiftKey) {    // CTRL+C or CTRL+INS\n          if (_onCopyInit) {\n            _onCopyInit.call();\n          }\n          ranges = _grid.getSelectionModel().getSelectedRanges();\n          if (ranges.length != 0) {\n            _copiedRanges = ranges;\n            markCopySelection(ranges);\n            _self.onCopyCells.notify({ranges: ranges});\n\n            var columns = _grid.getColumns();\n            var clipText = \"\";\n\n            for (var rg = 0; rg < ranges.length; rg++){\n                var range = ranges[rg];\n                var clipTextRows = [];\n                for (var i=range.fromRow; i< range.toRow+1 ; i++){\n                    var clipTextCells = [];\n                    var dt = _grid.getDataItem(i);\n\n                    if (clipTextRows == \"\" && _options.includeHeaderWhenCopying) {\n                        var clipTextHeaders = [];\n                        for (var j = range.fromCell; j < range.toCell + 1 ; j++) {\n                            if (columns[j].name.length > 0)\n                                clipTextHeaders.push(getHeaderValueForColumn(columns[j]));\n                        }\n                        clipTextRows.push(clipTextHeaders.join(\"\\t\"));\n                    }\n\n                    for (var j=range.fromCell; j< range.toCell+1 ; j++){\n                        clipTextCells.push(getDataItemValueForColumn(dt, columns[j], e));\n                    }\n                    clipTextRows.push(clipTextCells.join(\"\\t\"));\n                }\n                clipText += clipTextRows.join(\"\\r\\n\") + \"\\r\\n\";\n            }\n\n            if(window.clipboardData) {\n                window.clipboardData.setData(\"Text\", clipText);\n                return true;\n            }\n            else {\n                var focusEl = document.activeElement;\n\n                var ta = _createTextBox(clipText);\n\n                ta.focus();\n\n                setTimeout(function(){\n                     _bodyElement.removeChild(ta);\n                    // restore focus\n                    if (focusEl)\n                        focusEl.focus();\n                    else\n                        console.log(\"Not element to restore focus to after copy?\");\n\n                }, 100);\n\n                if (_onCopySuccess) {\n                    var rowCount = 0;\n                    // If it's cell selection, use the toRow/fromRow fields\n                    if (ranges.length === 1) {\n                        rowCount = (ranges[0].toRow + 1) - ranges[0].fromRow;\n                    }\n                    else {\n                        rowCount = ranges.length;\n                    }\n                    _onCopySuccess.call(this, rowCount);\n                }\n\n                return false;\n            }\n          }\n        }\n\n        if (!_options.readOnlyMode && (\n         (e.which === keyCodes.V && (e.ctrlKey || e.metaKey) && !e.shiftKey)\n          || (e.which === keyCodes.INSERT && e.shiftKey && !e.ctrlKey)\n         )) {    // CTRL+V or Shift+INS\n            var ta = _createTextBox('');\n\n            setTimeout(function(){\n                _decodeTabularData(_grid, ta);\n            }, 100);\n\n            return false;\n        }\n      }\n    }\n\n    function markCopySelection(ranges) {\n      clearCopySelection();\n\n      var columns = _grid.getColumns();\n      var hash = {};\n      for (var i = 0; i < ranges.length; i++) {\n        for (var j = ranges[i].fromRow; j <= ranges[i].toRow; j++) {\n          hash[j] = {};\n          for (var k = ranges[i].fromCell; k <= ranges[i].toCell && k<columns.length; k++) {\n            hash[j][columns[k].id] = _copiedCellStyle;\n          }\n        }\n      }\n      _grid.setCellCssStyles(_copiedCellStyleLayerKey, hash);\n      clearTimeout(_clearCopyTI);\n      _clearCopyTI = setTimeout(function(){\n        _self.clearCopySelection();\n      }, 2000);\n    }\n\n    function clearCopySelection() {\n      _grid.removeCellCssStyles(_copiedCellStyleLayerKey);\n    }\n\n    function setIncludeHeaderWhenCopying(includeHeaderWhenCopying) {\n      _options.includeHeaderWhenCopying = includeHeaderWhenCopying;\n    }\n    \n    $.extend(this, {\n      \"init\": init,\n      \"destroy\": destroy,\n      \"clearCopySelection\": clearCopySelection,\n      \"handleKeyDown\":handleKeyDown,\n\n      \"onCopyCells\": new Slick.Event(),\n      \"onCopyCancelled\": new Slick.Event(),\n      \"onPasteCells\": new Slick.Event(),\n      \"setIncludeHeaderWhenCopying\" : setIncludeHeaderWhenCopying\n    });\n  }\n\n  module.exports = {\n      \"CellExternalCopyManager\": CellExternalCopyManager\n  };\n"]},"metadata":{},"sourceType":"script"}